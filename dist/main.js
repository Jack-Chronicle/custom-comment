"use strict";var z=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var ae=Object.getOwnPropertyNames;var ce=Object.prototype.hasOwnProperty;var me=(h,a)=>{for(var e in a)z(h,e,{get:a[e],enumerable:!0})},he=(h,a,e,t)=>{if(a&&typeof a=="object"||typeof a=="function")for(let l of ae(a))!ce.call(h,l)&&l!==e&&z(h,l,{get:()=>a[l],enumerable:!(t=oe(a,l))||t.enumerable});return h};var ge=h=>he(z({},"__esModule",{value:!0}),h);var de={};me(de,{default:()=>N});module.exports=ge(de);var X=require("obsidian");var J={template:"%% {cursor} %%",wordOnlyMode:!1,additionalMarkers:[]};var v=require("obsidian"),W=class extends v.PluginSettingTab{constructor(a,e){super(a,e),this.plugin=e}display(){let{containerEl:a}=this;a.empty(),new v.Setting(a).setName("Comment Format").setDesc("Use {cursor} wherever you want the cursor to go (e.g. '%% {cursor} %%' or '<!-- {cursor} -->').").addText(t=>t.setValue(this.plugin.settings.template).onChange(async l=>{this.plugin.settings.template=l||"%% {cursor} %%",await this.plugin.saveSettings()})),new v.Setting(a).setName("Word-only toggle mode").setDesc("If enabled, toggling will un/comment the word at the cursor's location rather than inserting a comment at the cursor position.").addToggle(t=>t.setValue(!!this.plugin.settings.wordOnlyMode).onChange(async l=>{this.plugin.settings.wordOnlyMode=l,await this.plugin.saveSettings()})),a.createEl("h3",{text:"Additional Marker Sets"}),(this.plugin.settings.additionalMarkers||[]).forEach((t,l)=>{let f=new v.Setting(a).setName(`Marker Set ${l+1}`).addToggle(c=>c.setValue(!!t.registerCommand).onChange(async m=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[l].registerCommand=m,await this.plugin.saveSettings(),this.plugin.registerMarkerCommands(!0),this.display())})).addText(c=>c.setPlaceholder("Start marker").setValue(t.start).onChange(async m=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[l].start=m,await this.plugin.saveSettings())})).addText(c=>c.setPlaceholder("End marker").setValue(t.end).onChange(async m=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[l].end=m,await this.plugin.saveSettings())})).addExtraButton(c=>c.setIcon("cross").setTooltip("Remove marker set").onClick(async()=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers.splice(l,1),await this.plugin.saveSettings(),this.display())}))}),new v.Setting(a).addButton(t=>t.setButtonText("Add Marker Set").setCta().onClick(async()=>{this.plugin.settings.additionalMarkers||(this.plugin.settings.additionalMarkers=[]),this.plugin.settings.additionalMarkers.push({start:"",end:"",registerCommand:!1}),await this.plugin.saveSettings(),this.display()}))}};function j(h){return h.replace(/\s+/g," ").trim()}function q(h,a){let e=a.indexOf(h);if(e!==-1)return{idx:e,full:!0};for(let t=h.length-1;t>0;t--){if(a.includes(h.slice(0,t)))return{idx:a.indexOf(h.slice(0,t)),full:!1,partial:h.slice(0,t)};if(a.includes(h.slice(-t)))return{idx:a.indexOf(h.slice(-t)),full:!1,partial:h.slice(-t)}}return{idx:-1,full:!1}}function K(h,a){let e=/[\p{L}\p{N}_]+/gu,t;for(;(t=e.exec(h))!==null;)if(a>=t.index&&a<=t.index+t[0].length)return{start:t.index,end:t.index+t[0].length};return null}function Q(h){let a=h.getSelection();if(a)return{from:h.getCursor("from"),to:h.getCursor("to"),selection:a};{let e=h.getCursor();return{from:{line:e.line,ch:e.ch},to:{line:e.line,ch:e.ch},selection:""}}}function x(...h){}var N=class extends X.Plugin{constructor(){super(...arguments);this._markerCommandIds=[];this._cleanupGuard=!1}async onload(){x("Plugin loading..."),await this.loadSettings(),this.addSettingTab(new W(this.app,this)),this.addCommand({id:"reload-marker-commands",name:"Reload Marker Commands",callback:()=>this.registerMarkerCommands(!0)}),this.registerMarkerCommands();let e=this.settings.template??"%% {cursor} %%",t=e.indexOf("{cursor}"),l="%%",f="%%";t!==-1&&(l=e.slice(0,t).trim()||"%%",f=e.slice(t+8).trim()||"%%");let c=`${l}${l?" ":""}|${f?" ":""}${f}`.trim();this.addCommand({id:"toggle-comment-toolbar",name:`Toggle Comment: (${c})`,editorCallback:m=>this.toggleComment(m),icon:"ampersands",mobileOnly:!0})}registerMarkerCommands(e=!1){e&&this._markerCommandIds&&(this._markerCommandIds=[]),this._markerCommandIds=[];let t=this.settings.template??"%% {cursor} %%",l=t.indexOf("{cursor}"),f="%%",c="%%";l!==-1&&(f=t.slice(0,l).trim()||"%%",c=t.slice(l+8).trim()||"%%");let m="toggle-comment-template";this.addCommand({id:m,name:`Toggle Comment: (${f}|${c})`,editorCallback:g=>this.toggleComment(g)}),this._markerCommandIds.push(m),Array.isArray(this.settings.additionalMarkers)&&this.settings.additionalMarkers.forEach((g,n)=>{if(g&&g.registerCommand){let i=`toggle-comment-marker-set-${n+1}`;this.addCommand({id:i,name:(()=>{let C=g.start?.trim()||"%%",d=g.end?.trim()||"%%";return`Toggle Marker ${n+1}: (${C}|${d})`})(),checkCallback:(C,d)=>(!C&&d&&this.toggleComment(d,g),!0)}),this._markerCommandIds.push(i)}}),x("Marker commands registered:",this._markerCommandIds)}async loadSettings(){this.settings=Object.assign({},J,await this.loadData()),x("Settings loaded:",this.settings)}async saveSettings(){await this.saveData(this.settings),x("Settings saved:",this.settings)}async reloadPlugin(){await this.app.plugins.disablePlugin(this.manifest.id),await this.app.plugins.enablePlugin(this.manifest.id),x("Plugin reloaded")}insertComment(e){let t=this.settings.template,l=t.indexOf("{cursor}");if(l===-1){e.replaceSelection(t),x("Inserted template (no cursor placeholder)");return}let f=t.slice(0,l).trim(),c=t.slice(l+8).trim(),m=`${f} ${c}`.replace(/\s+/g," ").trim(),g=e.getCursor();e.replaceSelection(`${f}  ${c}`.replace(/\s+/g," ").replace(" "," {cursor} "));let n=f.split(`
`),i=n.length-1,C=n[n.length-1].length+1;e.setCursor({line:g.line+i,ch:(i?0:g.ch)+C}),x("Inserted comment at cursor")}toggleComment(e,t){x("toggleComment called",{selection:e.getSelection(),cursor:e.getCursor(),markerSet:t});let l,f;if(t)l=t.start.trim(),f=t.end.trim();else{let s=this.settings.template,r=s.indexOf("{cursor}"),o=s,b="";r!==-1&&(o=s.slice(0,r),b=s.slice(r+8)),l=o.trim(),f=b.trim()}let c=j(l),m=j(f),g=this.settings.wordOnlyMode,{from:n,to:i,selection:C}=Q(e),d=e.getCursor(),I=e.getLine(d.line),S,u=null;C?S=C:(u=K(I,d.ch),g&&u&&d.ch>=u.start&&d.ch<=u.end?(S=I.slice(u.start,u.end),n.line=d.line,n.ch=u.start,i.line=d.line,i.ch=u.end):S="");let F=null;g&&u&&d.ch>=u.start&&d.ch<=u.end&&(F=d.ch-u.start);let $=-1,R=-1,O="",Y=!1,_=c,L=m,ue=!!(_&&L&&_!==L);x("[Detection] selection:",C),x("[Detection] text:",S);let Z=q(c,S),ee=q(m,S);x("[Detection] foundStart:",Z),x("[Detection] foundEnd:",ee);let P=[],A=[],te=e.lineCount();for(let s=0;s<te;s++){let r=e.getLine(s),o=0;for(;(o=r.indexOf(c,o))!==-1;)P.push({line:s,ch:o}),o+=c.length;for(o=0;(o=r.indexOf(m,o))!==-1;)A.push({line:s,ch:o}),o+=m.length}let B=null,U=[];for(let s=0,r=0,o=0;s<P.length+A.length;){let b=r<P.length?P[r]:null,k=o<A.length?A[o]:null,E=!1;if(b&&(!k||b.line<k.line||b.line===k.line&&b.ch<k.ch))U.push(b),r++,E=!0;else if(k){if(U.length>0){let p=U.pop();if(p){let y=k,M={line:p.line,ch:p.ch},T={line:y.line,ch:y.ch+m.length},w=n,D=i,se=(w.line<T.line||w.line===T.line&&w.ch<T.ch)&&(D.line>M.line||D.line===M.line&&D.ch>M.ch),le=D.line<M.line||D.line===M.line&&D.ch<=M.ch,re=w.line>T.line||w.line===T.line&&w.ch>=T.ch;if(se&&!le&&!re){B={start:p,end:y};break}}}o++}else break}if(B){let{start:s,end:r}=B,o=0;e.getLine(s.line)[s.ch+c.length]===" "&&(o=1);let k=0,E=e.getLine(r.line);r.ch>0&&E[r.ch-1]===" "&&(k=1);let p=0,y=0;s.line===n.line&&s.ch<n.ch&&(p+=c.length+o),r.line===n.line&&r.ch<n.ch&&(p+=m.length+k),s.line===i.line&&s.ch<i.ch&&(y+=c.length+o),r.line===i.line&&r.ch<i.ch&&(y+=m.length+k),e.transaction({changes:[{from:{line:r.line,ch:r.ch-k},to:{line:r.line,ch:r.ch+m.length},text:""},{from:{line:s.line,ch:s.ch},to:{line:s.line,ch:s.ch+c.length+o},text:""}]});let M={...n},T={...i};if(p&&M.line===n.line&&(M.ch=Math.max(0,M.ch-p)),y&&T.line===i.line&&(T.ch=Math.max(M.ch,T.ch-y)),x("Uncommented marker pair encompassing selection",{from:n,to:i,pairToRemove:B,removedBeforeStart:p,removedBeforeEnd:y,selFrom:M,selTo:T}),n.line===i.line&&n.ch===i.ch||u&&n.line===i.line&&n.ch===u?.start&&i.ch===u?.end){let w;F!==null&&u?w=u.start+F-(p||0):w=n.ch-(p||0),e.setCursor({line:n.line,ch:Math.max(0,w)})}else e.setSelection(M,T);return}let ne=e.getRange(n,i),H=c+" "+ne+" "+m;e.replaceRange(H,n,i);let V=c.length+1;if(n.line===i.line&&n.ch===i.ch||u&&n.line===i.line&&n.ch===u.start&&i.ch===u.end){let s;F!==null?s=n.ch+V+F:s=n.ch+V,e.setCursor({line:n.line,ch:s})}else{let s={line:n.line,ch:n.ch+V},r;n.line===i.line?r={line:i.line,ch:i.ch+V}:r={line:i.line,ch:i.ch},e.setSelection(s,r)}x("Commented region (no marker pair found)",{from:n,to:i,commented:H});return;function ie(s){let r=e.getValue().split(`
`),o=Math.max(0,Math.min(s.line,r.length-1)),b=Math.max(0,Math.min(s.ch,r[o]?.length??0));return{line:o,ch:b}}}toggleCommentAtCursor(e){let t=this.settings.template,l=t.indexOf("{cursor}"),f=t,c="";l!==-1&&(f=t.slice(0,l),c=t.slice(l+8));let m=f.trim(),g=c.trim(),n=e.getCursor(),i=e.getLine(n.line),C=i.indexOf(m),d=g?i.lastIndexOf(g):-1,I=!1;if(m&&g?I=C!==-1&&d!==-1&&n.ch>=C+m.length&&n.ch<=d+g.length:m&&(I=C!==-1&&n.ch>=C+m.length),I){let S=i;m&&(S=S.replace(m,"")),g&&(S=S.replace(g,"")),S=S.trim(),e.setLine(n.line,S)}}};
//# sourceMappingURL=main.js.map
