"use strict";var J=Object.defineProperty;var le=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var ae=Object.prototype.hasOwnProperty;var oe=(y,C)=>{for(var t in C)J(y,t,{get:C[t],enumerable:!0})},ce=(y,C,t,o)=>{if(C&&typeof C=="object"||typeof C=="function")for(let c of re(C))!ae.call(y,c)&&c!==t&&J(y,c,{get:()=>C[c],enumerable:!(o=le(C,c))||o.enumerable});return y};var de=y=>ce(J({},"__esModule",{value:!0}),y);var he={};oe(he,{default:()=>q});module.exports=de(he);var Q=require("obsidian");var K={template:"%% {cursor} %%",wordOnlyMode:!1,additionalMarkers:[]};var V=require("obsidian"),j=class extends V.PluginSettingTab{constructor(C,t){super(C,t),this.plugin=t}display(){let{containerEl:C}=this;C.empty(),new V.Setting(C).setName("Comment Format").setDesc("Use {cursor} wherever you want the cursor to go (e.g. '%% {cursor} %%' or '<!-- {cursor} -->').").addText(o=>o.setValue(this.plugin.settings.template).onChange(async c=>{this.plugin.settings.template=c||"%% {cursor} %%",await this.plugin.saveSettings()})),new V.Setting(C).setName("Word-only toggle mode").setDesc("If enabled, toggling will un/comment the word at the cursor's location rather than inserting a comment at the cursor position.").addToggle(o=>o.setValue(!!this.plugin.settings.wordOnlyMode).onChange(async c=>{this.plugin.settings.wordOnlyMode=c,await this.plugin.saveSettings()})),C.createEl("h3",{text:"Additional Marker Sets"}),(this.plugin.settings.additionalMarkers||[]).forEach((o,c)=>{let M=new V.Setting(C).setName(`Marker Set ${c+1}`).addToggle(f=>f.setValue(!!o.registerCommand).onChange(async h=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].registerCommand=h,await this.plugin.saveSettings(),this.plugin.registerMarkerCommands(!0),this.display())})).addText(f=>f.setPlaceholder("Start marker").setValue(o.start).onChange(async h=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].start=h,await this.plugin.saveSettings())})).addText(f=>f.setPlaceholder("End marker").setValue(o.end).onChange(async h=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].end=h,await this.plugin.saveSettings())})).addExtraButton(f=>f.setIcon("cross").setTooltip("Remove marker set").onClick(async()=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers.splice(c,1),await this.plugin.saveSettings(),this.display())}))}),new V.Setting(C).addButton(o=>o.setButtonText("Add Marker Set").setCta().onClick(async()=>{this.plugin.settings.additionalMarkers||(this.plugin.settings.additionalMarkers=[]),this.plugin.settings.additionalMarkers.push({start:"",end:"",registerCommand:!1}),await this.plugin.saveSettings(),this.display()}))}};function x(...y){console.log("[CustomComment DEV]",...y)}var ge=[{start:"%%",end:"%%"},{start:"<!--",end:"-->"},{start:"//",end:""}],q=class extends Q.Plugin{constructor(){super(...arguments);this._markerCommandIds=[];this._cleanupGuard=!1}async onload(){x("Plugin loading..."),await this.loadSettings(),this.addSettingTab(new j(this.app,this)),this.addCommand({id:"reload-marker-commands",name:"Reload Marker Commands",callback:()=>this.registerMarkerCommands(!0)}),this.registerMarkerCommands()}registerMarkerCommands(t=!1){t&&this._markerCommandIds&&(this._markerCommandIds=[]),this._markerCommandIds=[];let o=this.settings.template??"%% {cursor} %%",c=o.indexOf("{cursor}"),M="%%",f="%%";c!==-1&&(M=o.slice(0,c).trim()||"%%",f=o.slice(c+8).trim()||"%%");let h="toggle-comment-template";this.addCommand({id:h,name:`Toggle Comment: (${M}|${f})`,editorCallback:m=>this.toggleComment(m)}),this._markerCommandIds.push(h),Array.isArray(this.settings.additionalMarkers)&&this.settings.additionalMarkers.forEach((m,k)=>{if(m&&m.registerCommand){let I=`toggle-comment-marker-set-${k+1}`;this.addCommand({id:I,name:(()=>{let T=m.start?.trim()||"%%",v=m.end?.trim()||"%%";return`Toggle Marker ${k+1}: (${T}|${v})`})(),checkCallback:(T,v)=>(!T&&v&&this.toggleComment(v,m),!0)}),this._markerCommandIds.push(I)}}),x("Marker commands registered:",this._markerCommandIds)}async loadSettings(){this.settings=Object.assign({},K,await this.loadData()),x("Settings loaded:",this.settings)}async saveSettings(){await this.saveData(this.settings),x("Settings saved:",this.settings)}async reloadPlugin(){await this.app.plugins.disablePlugin(this.manifest.id),await this.app.plugins.enablePlugin(this.manifest.id),x("Plugin reloaded")}insertComment(t){let o=this.settings.template,c=o.indexOf("{cursor}");if(c===-1){t.replaceSelection(o),x("Inserted template (no cursor placeholder)");return}let M=o.slice(0,c).trim(),f=o.slice(c+8).trim(),h=`${M} ${f}`.replace(/\s+/g," ").trim(),m=t.getCursor();t.replaceSelection(`${M}  ${f}`.replace(/\s+/g," ").replace(" "," {cursor} "));let k=M.split(`
`),I=k.length-1,T=k[k.length-1].length+1;t.setCursor({line:m.line+I,ch:(I?0:m.ch)+T}),x("Inserted comment at cursor")}toggleComment(t,o){x("toggleComment called",{selection:t.getSelection(),cursor:t.getCursor(),markerSet:o});let c,M;if(o)c=o.start.trim(),M=o.end.trim();else{let e=this.settings.template,n=e.indexOf("{cursor}"),a=e,i="";n!==-1&&(a=e.slice(0,n),i=e.slice(n+8)),c=a.trim(),M=i.trim()}function f(e){return e.replace(/\s+/g," ").trim()}let h=f(c),m=f(M);function k(e,n){let a=n.indexOf(e);if(a!==-1)return{idx:a,full:!0};for(let i=e.length-1;i>0;i--){if(n.includes(e.slice(0,i)))return{idx:n.indexOf(e.slice(0,i)),full:!1,partial:e.slice(0,i)};if(n.includes(e.slice(-i)))return{idx:n.indexOf(e.slice(-i)),full:!1,partial:e.slice(-i)}}return{idx:-1,full:!1}}function I({line:e,marker:n,partialIdx:a,isStart:i,otherMarker:O,uniqueMarkers:s=!0}){let l=n.length,r=-1;for(let g=Math.max(0,a-l+1);g<=a;g++)if(e.slice(g,g+l)===n){r=g;break}if(r===-1){for(let g=a;g<=Math.min(e.length-l,a+l-1);g++)if(e.slice(g,g+l)===n){r=g;break}}if(r===-1)return{confirmed:!1};if(i){let g=e.indexOf(O,r+l);if(g===-1)return{confirmed:!1};if(s){let p=e.indexOf(n,r+l);if(p!==-1&&p<g)return{confirmed:!1}}return{confirmed:!0,startIdx:r,endIdx:g}}else{let g=e.lastIndexOf(O,r-1);if(g===-1)return{confirmed:!1};if(s){let p=e.lastIndexOf(n,r-1);if(p!==-1&&p>g)return{confirmed:!1}}return{confirmed:!0,startIdx:g,endIdx:r}}}function T(e,n,a){return a==="back"?P.lastIndexOf(e,n):P.indexOf(e,n)}function v(e,n,a){let i=e.trim();return n&&a?i.startsWith(n)&&i.endsWith(a):n?i.startsWith(n):!1}function N(e){for(let n of ge){let a=f(n.start),i=f(n.end);if(v(e,a,i))return{found:!0,markerStart:n.start,markerEnd:n.end}}return{found:!1}}let S=t.getSelection(),b=t.getCursor(),u=t.getCursor("from"),d=t.getCursor("to"),P=t.getLine(b.line),$,F=null;function X(e,n){let a=/[\p{L}\p{N}_]+/gu,i;for(;(i=a.exec(e))!==null;)if(n>=i.index&&n<=i.index+i[0].length)return{start:i.index,end:i.index+i[0].length};return null}S?$=S:(F=X(P,b.ch),F&&b.ch>F.start&&b.ch<F.end?($=P.slice(F.start,F.end),u={line:b.line,ch:F.start},d={line:b.line,ch:F.end}):($="",u={line:b.line,ch:b.ch},d={line:b.line,ch:b.ch}));let U=-1,G=-1,L="",Y=!1,R=h,A=m,me=!!(R&&A&&R!==A);x("[Detection] selection:",S),x("[Detection] text:",$);let Z=k(h,$),ee=k(m,$);if(x("[Detection] foundStart:",Z),x("[Detection] foundEnd:",ee),S){let e=[],n=[],a=t.lineCount();for(let s=0;s<a;s++){let l=t.getLine(s),r=0;for(;(r=l.indexOf(h,r))!==-1;)e.push({line:s,ch:r}),r+=h.length;for(r=0;(r=l.indexOf(m,r))!==-1;)n.push({line:s,ch:r}),r+=m.length}let i=null,O=[];for(let s=0,l=0,r=0;s<e.length+n.length;){let g=l<e.length?e[l]:null,p=r<n.length?n[r]:null,H=!1;if(g&&(!p||g.line<p.line||g.line===p.line&&g.ch<p.ch))O.push(g),l++,H=!0;else if(p){if(O.length>0){let _=O.pop();if(_){let D=p,E={line:_.line,ch:_.ch},w={line:D.line,ch:D.ch+m.length},B=u,W=d,ne=(B.line<w.line||B.line===w.line&&B.ch<w.ch)&&(W.line>E.line||W.line===E.line&&W.ch>E.ch),ie=W.line<E.line||W.line===E.line&&W.ch<=E.ch,se=B.line>w.line||B.line===w.line&&B.ch>=w.ch;if(ne&&!ie&&!se){i={start:_,end:D};break}}}r++}else break}if(i){let{start:s,end:l}=i,r=0;t.getLine(s.line)[s.ch+h.length]===" "&&(r=1);let p=0,H=t.getLine(l.line);l.ch>0&&H[l.ch-1]===" "&&(p=1);let _=0,D=0;s.line===u.line&&s.ch<u.ch&&(_+=h.length+r),l.line===u.line&&l.ch<u.ch&&(_+=m.length+p),s.line===d.line&&s.ch<d.ch&&(D+=h.length+r),l.line===d.line&&l.ch<d.ch&&(D+=m.length+p),t.transaction({changes:[{from:{line:l.line,ch:l.ch-p},to:{line:l.line,ch:l.ch+m.length},text:""},{from:{line:s.line,ch:s.ch},to:{line:s.line,ch:s.ch+h.length+r},text:""}]});let E={...u},w={...d};_&&E.line===u.line&&(E.ch=Math.max(0,E.ch-_)),D&&w.line===d.line&&(w.ch=Math.max(E.ch,w.ch-D)),x("Uncommented marker pair encompassing selection",{from:u,to:d,pairToRemove:i,removedBeforeStart:_,removedBeforeEnd:D,selFrom:E,selTo:w}),t.setSelection(E,w);return}if(S){let s=t.getRange(u,d),l=h+(s?" ":"")+s+(s?" ":"")+m;t.replaceRange(l,u,d);let r=h.length+(s?1:0),g={line:u.line,ch:u.ch+r},p;u.line===d.line?p={line:d.line,ch:d.ch+r}:p={line:d.line,ch:d.ch},t.setSelection(g,p),x("Commented region (no marker pair found)",{from:u,to:d,commented:l});return}}else return;if(Y){let e=P.slice(0,U),n=P.slice(A&&G!==-1?G+A.length:P.length),a=0;L.startsWith(" ")&&(L=L.slice(1),a=1);let i=0;L.endsWith(" ")&&(L=L.slice(0,-1),i=1);let O=e+L+n;if(t.setLine(b.line,O),S){let s=u.ch,l=d.ch;u.ch<=U+R.length+a?s=U:s=u.ch-R.length+a,A&&G!==-1&&d.ch>=G?l=U+L.length:l=d.ch-R.length+a,s=Math.max(0,s),l=Math.max(s,l);let r={line:b.line,ch:s},g={line:b.line,ch:l};t.setSelection(r,g),x("Uncommented region",{from:u,to:d,region:L})}else return}else if(S){let e=t.getRange(u,d),n=R+(e?" ":"")+e+(e?" ":"")+A;t.replaceRange(n,u,d);let a=R.length+(e?1:0),i=A.length+(e?1:0),O={line:u.line,ch:u.ch+a},s;u.line===d.line?s={line:d.line,ch:d.ch+a}:s={line:d.line,ch:d.ch},t.setSelection(O,s),x("Commented region",{from:u,to:d,commented:n})}else return;function te(e){let n=t.getValue().split(`
`),a=Math.max(0,Math.min(e.line,n.length-1)),i=Math.max(0,Math.min(e.ch,n[a]?.length??0));return{line:a,ch:i}}let z=te(t.getCursor());(z.line!==t.getCursor().line||z.ch!==t.getCursor().ch)&&t.setCursor(z)}toggleCommentAtCursor(t){let o=this.settings.template,c=o.indexOf("{cursor}"),M=o,f="";c!==-1&&(M=o.slice(0,c),f=o.slice(c+8));let h=M.trim(),m=f.trim(),k=t.getCursor(),I=t.getLine(k.line),T=I.indexOf(h),v=m?I.lastIndexOf(m):-1,N=!1;if(h&&m?N=T!==-1&&v!==-1&&k.ch>=T+h.length&&k.ch<=v+m.length:h&&(N=T!==-1&&k.ch>=T+h.length),N){let S=I;h&&(S=S.replace(h,"")),m&&(S=S.replace(m,"")),S=S.trim(),t.setLine(k.line,S)}}};
//# sourceMappingURL=main.js.map
