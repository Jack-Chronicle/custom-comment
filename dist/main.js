"use strict";var q=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(P,C)=>{for(var n in C)q(P,n,{get:C[n],enumerable:!0})},ee=(P,C,n,o)=>{if(C&&typeof C=="object"||typeof C=="function")for(let c of X(C))!Y.call(P,c)&&c!==n&&q(P,c,{get:()=>C[c],enumerable:!(o=Q(C,c))||o.enumerable});return P};var te=P=>ee(q({},"__esModule",{value:!0}),P);var ie={};Z(ie,{default:()=>G});module.exports=te(ie);var H=require("obsidian");var z={template:"%% {cursor} %%",wordOnlyMode:!1,additionalMarkers:[]};var A=require("obsidian"),U=class extends A.PluginSettingTab{constructor(C,n){super(C,n),this.plugin=n}display(){let{containerEl:C}=this;C.empty(),new A.Setting(C).setName("Comment Format").setDesc("Use {cursor} wherever you want the cursor to go (e.g. '%% {cursor} %%' or '<!-- {cursor} -->').").addText(o=>o.setValue(this.plugin.settings.template).onChange(async c=>{this.plugin.settings.template=c||"%% {cursor} %%",await this.plugin.saveSettings()})),new A.Setting(C).setName("Word-only toggle mode").setDesc("If enabled, toggling will un/comment the word at the cursor's location rather than inserting a comment at the cursor position.").addToggle(o=>o.setValue(!!this.plugin.settings.wordOnlyMode).onChange(async c=>{this.plugin.settings.wordOnlyMode=c,await this.plugin.saveSettings()})),C.createEl("h3",{text:"Additional Marker Sets"}),(this.plugin.settings.additionalMarkers||[]).forEach((o,c)=>{let D=new A.Setting(C).setName(`Marker Set ${c+1}`).addToggle(u=>u.setValue(!!o.registerCommand).onChange(async s=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].registerCommand=s,await this.plugin.saveSettings(),this.plugin.registerMarkerCommands(!0),this.display())})).addText(u=>u.setPlaceholder("Start marker").setValue(o.start).onChange(async s=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].start=s,await this.plugin.saveSettings())})).addText(u=>u.setPlaceholder("End marker").setValue(o.end).onChange(async s=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].end=s,await this.plugin.saveSettings())})).addExtraButton(u=>u.setIcon("cross").setTooltip("Remove marker set").onClick(async()=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers.splice(c,1),await this.plugin.saveSettings(),this.display())}))}),new A.Setting(C).addButton(o=>o.setButtonText("Add Marker Set").setCta().onClick(async()=>{this.plugin.settings.additionalMarkers||(this.plugin.settings.additionalMarkers=[]),this.plugin.settings.additionalMarkers.push({start:"",end:"",registerCommand:!1}),await this.plugin.saveSettings(),this.display()}))}};function m(...P){console.log("[CustomComment DEV]",...P)}var ne=[{start:"%%",end:"%%"},{start:"<!--",end:"-->"},{start:"//",end:""}],G=class extends H.Plugin{constructor(){super(...arguments);this._markerCommandIds=[];this._cleanupGuard=!1}async onload(){m("Plugin loading..."),await this.loadSettings(),this.addSettingTab(new U(this.app,this)),this.addCommand({id:"reload-marker-commands",name:"Reload Marker Commands",callback:()=>this.registerMarkerCommands(!0)}),this.registerMarkerCommands()}registerMarkerCommands(n=!1){n&&this._markerCommandIds&&(this._markerCommandIds=[]),this._markerCommandIds=[];let o=this.settings.template??"%% {cursor} %%",c=o.indexOf("{cursor}"),D="%%",u="%%";c!==-1&&(D=o.slice(0,c).trim()||"%%",u=o.slice(c+8).trim()||"%%");let s="toggle-comment-template";this.addCommand({id:s,name:`Toggle Comment: (${D}|${u})`,editorCallback:r=>this.toggleComment(r)}),this._markerCommandIds.push(s),Array.isArray(this.settings.additionalMarkers)&&this.settings.additionalMarkers.forEach((r,y)=>{if(r&&r.registerCommand){let O=`toggle-comment-marker-set-${y+1}`;this.addCommand({id:O,name:(()=>{let p=r.start?.trim()||"%%",v=r.end?.trim()||"%%";return`Toggle Marker ${y+1}: (${p}|${v})`})(),checkCallback:(p,v)=>(!p&&v&&this.toggleComment(v,r),!0)}),this._markerCommandIds.push(O)}}),m("Marker commands registered:",this._markerCommandIds)}async loadSettings(){this.settings=Object.assign({},z,await this.loadData()),m("Settings loaded:",this.settings)}async saveSettings(){await this.saveData(this.settings),m("Settings saved:",this.settings)}async reloadPlugin(){await this.app.plugins.disablePlugin(this.manifest.id),await this.app.plugins.enablePlugin(this.manifest.id),m("Plugin reloaded")}insertComment(n){let o=this.settings.template,c=o.indexOf("{cursor}");if(c===-1){n.replaceSelection(o),m("Inserted template (no cursor placeholder)");return}let D=o.slice(0,c).trim(),u=o.slice(c+8).trim(),s=`${D} ${u}`.replace(/\s+/g," ").trim(),r=n.getCursor();n.replaceSelection(`${D}  ${u}`.replace(/\s+/g," ").replace(" "," {cursor} "));let y=D.split(`
`),O=y.length-1,p=y[y.length-1].length+1;n.setCursor({line:r.line+O,ch:(O?0:r.ch)+p}),m("Inserted comment at cursor")}toggleComment(n,o){m("toggleComment called",{selection:n.getSelection(),cursor:n.getCursor(),markerSet:o});let c,D;if(o)c=o.start.trim(),D=o.end.trim();else{let e=this.settings.template,t=e.indexOf("{cursor}"),a=e,i="";t!==-1&&(a=e.slice(0,t),i=e.slice(t+8)),c=a.trim(),D=i.trim()}function u(e){return e.replace(/\s+/g," ").trim()}let s=u(c),r=u(D);function y(e,t){let a=t.indexOf(e);if(a!==-1)return{idx:a,full:!0};for(let i=e.length-1;i>0;i--){if(t.includes(e.slice(0,i)))return{idx:t.indexOf(e.slice(0,i)),full:!1,partial:e.slice(0,i)};if(t.includes(e.slice(-i)))return{idx:t.indexOf(e.slice(-i)),full:!1,partial:e.slice(-i)}}return{idx:-1,full:!1}}function O({line:e,marker:t,partialIdx:a,isStart:i,otherMarker:$,uniqueMarkers:_=!0}){let S=t.length,E=-1;for(let x=Math.max(0,a-S+1);x<=a;x++)if(e.slice(x,x+S)===t){E=x;break}if(E===-1){for(let x=a;x<=Math.min(e.length-S,a+S-1);x++)if(e.slice(x,x+S)===t){E=x;break}}if(E===-1)return{confirmed:!1};if(i){let x=e.indexOf($,E+S);if(x===-1)return{confirmed:!1};if(_){let B=e.indexOf(t,E+S);if(B!==-1&&B<x)return{confirmed:!1}}return{confirmed:!0,startIdx:E,endIdx:x}}else{let x=e.lastIndexOf($,E-1);if(x===-1)return{confirmed:!1};if(_){let B=e.lastIndexOf(t,E-1);if(B!==-1&&B>x)return{confirmed:!1}}return{confirmed:!0,startIdx:x,endIdx:E}}}function p(e,t,a){return a==="back"?g.lastIndexOf(e,t):g.indexOf(e,t)}function v(e,t,a){let i=e.trim();return t&&a?i.startsWith(t)&&i.endsWith(a):t?i.startsWith(t):!1}function W(e){for(let t of ne){let a=u(t.start),i=u(t.end);if(v(e,a,i))return{found:!0,markerStart:t.start,markerEnd:t.end}}return{found:!1}}let w=n.getSelection(),l=n.getCursor(),I=n.getCursor("from"),M=n.getCursor("to"),g=n.getLine(l.line),F,h=null;function J(e,t){let a=/[\p{L}\p{N}_]+/gu,i;for(;(i=a.exec(e))!==null;)if(t>=i.index&&t<=i.index+i[0].length)return{start:i.index,end:i.index+i[0].length};return null}w?F=w:(h=J(g,l.ch),h&&l.ch>h.start&&l.ch<h.end?(F=g.slice(h.start,h.end),I={line:l.line,ch:h.start},M={line:l.line,ch:h.end}):(F="",I={line:l.line,ch:l.ch},M={line:l.line,ch:l.ch}));let f=-1,d=-1,T="",R=!1,b=s,k=r,N=!!(b&&k&&b!==k);m("[Detection] selection:",w),m("[Detection] text:",F);let L=y(s,F),V=y(r,F);if(m("[Detection] foundStart:",L),m("[Detection] foundEnd:",V),w)if(L.full&&V.full)m("[Detection] Both full markers found in selection."),f=p(s,M.ch,"back"),d=p(r,I.ch,"forward");else if(L.full){m("[Detection] Only full start marker found in selection.");let e=F.indexOf(s);e!==-1&&(f=I.ch+e,d=p(r,f+s.length,"forward"))}else if(V.full){m("[Detection] Only full end marker found in selection.");let e=F.indexOf(r);e!==-1&&(d=I.ch+e,f=p(s,d,"back"))}else if(L.idx!==-1&&!L.full){m("[Detection] Partial start marker found in selection.");let e=O({line:g,marker:s,partialIdx:I.ch+L.idx,isStart:!0,otherMarker:r,uniqueMarkers:N});if(m("[Detection] confirmPartialMarker result (start):",e),e.confirmed&&e.startIdx!==void 0&&e.endIdx!==void 0)f=e.startIdx,d=e.endIdx;else if(L.partial&&r.startsWith(L.partial)){m("[Detection] Partial start marker did not confirm, trying as partial end marker.");let t=O({line:g,marker:r,partialIdx:I.ch+L.idx,isStart:!1,otherMarker:s,uniqueMarkers:N});m("[Detection] confirmPartialMarker result (as end):",t),t.confirmed&&t.startIdx!==void 0&&t.endIdx!==void 0&&(f=t.startIdx,d=t.endIdx)}}else if(V.idx!==-1&&!V.full){m("[Detection] Partial end marker found in selection.");let e=O({line:g,marker:r,partialIdx:M.ch+V.idx,isStart:!1,otherMarker:s,uniqueMarkers:N});if(m("[Detection] confirmPartialMarker result (end):",e),e.confirmed&&e.startIdx!==void 0&&e.endIdx!==void 0)f=e.startIdx,d=e.endIdx;else if(V.partial&&s.startsWith(V.partial)){m("[Detection] Partial end marker did not confirm, trying as partial start marker.");let t=O({line:g,marker:s,partialIdx:M.ch+V.idx,isStart:!0,otherMarker:r,uniqueMarkers:N});m("[Detection] confirmPartialMarker result (as start):",t),t.confirmed&&t.startIdx!==void 0&&t.endIdx!==void 0&&(f=t.startIdx,d=t.endIdx)}}else m("[Detection] No marker found in selection, searching line."),f=p(s,M.ch,"back"),d=p(r,I.ch,"forward");else if(h)f=p(s,h.start,"back"),d=p(r,h.end,"forward");else if(f=p(s,l.ch,"back"),d=p(r,l.ch,"forward"),!w&&!h&&!F.trim()&&s&&r){let e=g.indexOf(s),t=r?g.lastIndexOf(r):-1;e!==-1&&t!==-1&&l.ch>=e+s.length&&l.ch<=t+r.length&&(f=e,d=t)}if(m("[Detection] startIdx:",f,"endIdx:",d),m("[Detection] region:",T),m("[Detection] regionIsComment:",R),f!==-1&&(!k||d!==-1&&f<d)){let e=f+s.length,t=k&&d!==-1?d:g.length;T=g.slice(e,t),v(g.slice(f,k&&d!==-1?d+r.length:g.length),s,r)&&(R=!0)}else{let e=W(g);if(e.found&&(b=e.markerStart?u(e.markerStart):"",k=e.markerEnd?u(e.markerEnd):"",f=p(b,l.ch,"back"),d=p(k,l.ch,"forward"),f!==-1&&(!k||d!==-1&&f<d))){let t=f+b.length,a=k&&d!==-1?d:g.length;T=g.slice(t,a),v(g.slice(f,k&&d!==-1?d+k.length:g.length),b,k)&&(R=!0)}}if(R){let e=g.slice(0,f),t=g.slice(k&&d!==-1?d+k.length:g.length),a=0;T.startsWith(" ")&&(T=T.slice(1),a=1);let i=0;T.endsWith(" ")&&(T=T.slice(0,-1),i=1);let $=e+T+t;if(n.setLine(l.line,$),w){let _=I.ch,S=M.ch;I.ch<=f+b.length+a?_=f:_=I.ch-b.length-a,k&&d!==-1&&M.ch>=d?S=f+T.length:S=M.ch-b.length-a,_=Math.max(0,_),S=Math.max(_,S);let E={line:l.line,ch:_},x={line:l.line,ch:S};n.setSelection(E,x)}else if(h){let _={line:l.line,ch:e.length},S={line:l.line,ch:e.length+T.length};n.setSelection(_,S)}else{let _={line:l.line,ch:e.length},S={line:l.line,ch:e.length+T.length};n.setSelection(_,S)}m("Uncommented region",{from:I,to:M,region:T})}else{let e=F;!w&&!h&&!F.trim()&&(e="");let t,a;if(w){let i=n.getRange(I,M);t=b+(i?" ":"")+i+(i?" ":"")+k,n.replaceRange(t,I,M);let $=b.length+(i?1:0),_=k.length+(i?1:0),S={line:I.line,ch:I.ch+$},E;I.line===M.line?E={line:M.line,ch:M.ch+$}:E={line:M.line,ch:M.ch},n.setSelection(S,E)}else if(h&&this.settings.wordOnlyMode){t=b+" "+g.slice(h.start,h.end)+" "+k,a=g.slice(0,h.start)+t+g.slice(h.end),n.setLine(l.line,a);let i={line:l.line,ch:h.start+b.length+1},$={line:l.line,ch:h.start+b.length+1+(h.end-h.start)};n.setSelection(i,$)}else h?(t=b+"  "+k,a=g.slice(0,l.ch)+t+g.slice(l.ch),n.setLine(l.line,a),n.setCursor({line:l.line,ch:l.ch+b.length+1})):(t=b+"  "+k,a=g.slice(0,l.ch)+t+g.slice(l.ch),n.setLine(l.line,a),n.setCursor({line:l.line,ch:l.ch+b.length+1}));m("Commented region",{from:I,to:M,commented:t})}function K(e){let t=n.getValue().split(`
`),a=Math.max(0,Math.min(e.line,t.length-1)),i=Math.max(0,Math.min(e.ch,t[a]?.length??0));return{line:a,ch:i}}let j=K(n.getCursor());(j.line!==n.getCursor().line||j.ch!==n.getCursor().ch)&&n.setCursor(j)}toggleCommentAtCursor(n){let o=this.settings.template,c=o.indexOf("{cursor}"),D=o,u="";c!==-1&&(D=o.slice(0,c),u=o.slice(c+8));let s=D.trim(),r=u.trim(),y=n.getCursor(),O=n.getLine(y.line),p=O.indexOf(s),v=r?O.lastIndexOf(r):-1,W=!1;if(s&&r?W=p!==-1&&v!==-1&&y.ch>=p+s.length&&y.ch<=v+r.length:s&&(W=p!==-1&&y.ch>=p+s.length),W){let w=O;s&&(w=w.replace(s,"")),r&&(w=w.replace(r,"")),w=w.trim(),n.setLine(y.line,w)}}};
//# sourceMappingURL=main.js.map
