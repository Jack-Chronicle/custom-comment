"use strict";var V=Object.defineProperty;var G=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var z=Object.prototype.hasOwnProperty;var q=(E,u)=>{for(var s in u)V(E,s,{get:u[s],enumerable:!0})},H=(E,u,s,r)=>{if(u&&typeof u=="object"||typeof u=="function")for(let l of j(u))!z.call(E,l)&&l!==s&&V(E,l,{get:()=>u[l],enumerable:!(r=G(u,l))||r.enumerable});return E};var J=E=>H(V({},"__esModule",{value:!0}),E);var Q={};q(Q,{default:()=>F});module.exports=J(Q);var W=require("obsidian");var A={template:"%% {cursor} %%",wordOnlyMode:!1,additionalMarkers:[]};var v=require("obsidian"),L=class extends v.PluginSettingTab{constructor(u,s){super(u,s),this.plugin=s}display(){let{containerEl:u}=this;u.empty(),new v.Setting(u).setName("Comment Format").setDesc("Use {cursor} wherever you want the cursor to go (e.g. '%% {cursor} %%' or '<!-- {cursor} -->').").addText(r=>r.setValue(this.plugin.settings.template).onChange(async l=>{this.plugin.settings.template=l||"%% {cursor} %%",await this.plugin.saveSettings()})),new v.Setting(u).setName("Word-only toggle mode").setDesc("If enabled, toggling will un/comment the word at the cursor's location rather than inserting a comment at the cursor position.").addToggle(r=>r.setValue(!!this.plugin.settings.wordOnlyMode).onChange(async l=>{this.plugin.settings.wordOnlyMode=l,await this.plugin.saveSettings()})),u.createEl("h3",{text:"Additional Marker Sets"}),(this.plugin.settings.additionalMarkers||[]).forEach((r,l)=>{let w=new v.Setting(u).setName(`Marker Set ${l+1}`).addToggle(d=>d.setValue(!!r.registerCommand).onChange(async o=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[l].registerCommand=o,await this.plugin.saveSettings(),this.plugin.registerMarkerCommands(!0),this.display())})).addText(d=>d.setPlaceholder("Start marker").setValue(r.start).onChange(async o=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[l].start=o,await this.plugin.saveSettings())})).addText(d=>d.setPlaceholder("End marker").setValue(r.end).onChange(async o=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[l].end=o,await this.plugin.saveSettings())})).addExtraButton(d=>d.setIcon("cross").setTooltip("Remove marker set").onClick(async()=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers.splice(l,1),await this.plugin.saveSettings(),this.display())}))}),new v.Setting(u).addButton(r=>r.setButtonText("Add Marker Set").setCta().onClick(async()=>{this.plugin.settings.additionalMarkers||(this.plugin.settings.additionalMarkers=[]),this.plugin.settings.additionalMarkers.push({start:"",end:"",registerCommand:!1}),await this.plugin.saveSettings(),this.display()}))}};function _(...E){console.log("[CustomComment DEV]",...E)}var K=[{start:"%%",end:"%%"},{start:"<!--",end:"-->"},{start:"//",end:""}],F=class extends W.Plugin{constructor(){super(...arguments);this._markerCommandIds=[];this._cleanupGuard=!1}async onload(){_("Plugin loading..."),await this.loadSettings(),this.addSettingTab(new L(this.app,this)),this.addCommand({id:"reload-marker-commands",name:"Reload Marker Commands",callback:()=>this.registerMarkerCommands(!0)}),this.registerMarkerCommands()}registerMarkerCommands(s=!1){s&&this._markerCommandIds&&(this._markerCommandIds=[]),this._markerCommandIds=[];let r=this.settings.template??"%% {cursor} %%",l=r.indexOf("{cursor}"),w="%%",d="%%";l!==-1&&(w=r.slice(0,l).trim()||"%%",d=r.slice(l+8).trim()||"%%");let o="toggle-comment-template";this.addCommand({id:o,name:`Toggle Comment: (${w}|${d})`,editorCallback:c=>this.toggleComment(c)}),this._markerCommandIds.push(o),Array.isArray(this.settings.additionalMarkers)&&this.settings.additionalMarkers.forEach((c,k)=>{if(c&&c.registerCommand){let I=`toggle-comment-marker-set-${k+1}`;this.addCommand({id:I,name:(()=>{let p=c.start?.trim()||"%%",n=c.end?.trim()||"%%";return`Toggle Marker ${k+1}: (${p}|${n})`})(),checkCallback:(p,n)=>(!p&&n&&this.toggleComment(n,c),!0)}),this._markerCommandIds.push(I)}}),_("Marker commands registered:",this._markerCommandIds)}async loadSettings(){this.settings=Object.assign({},A,await this.loadData()),_("Settings loaded:",this.settings)}async saveSettings(){await this.saveData(this.settings),_("Settings saved:",this.settings)}async reloadPlugin(){await this.app.plugins.disablePlugin(this.manifest.id),await this.app.plugins.enablePlugin(this.manifest.id),_("Plugin reloaded")}insertComment(s){let r=this.settings.template,l=r.indexOf("{cursor}");if(l===-1){s.replaceSelection(r),_("Inserted template (no cursor placeholder)");return}let w=r.slice(0,l).trim(),d=r.slice(l+8).trim(),o=`${w} ${d}`.replace(/\s+/g," ").trim(),c=s.getCursor();s.replaceSelection(`${w}  ${d}`.replace(/\s+/g," ").replace(" "," {cursor} "));let k=w.split(`
`),I=k.length-1,p=k[k.length-1].length+1;s.setCursor({line:c.line+I,ch:(I?0:c.ch)+p}),_("Inserted comment at cursor")}toggleComment(s,r){_("toggleComment called",{selection:s.getSelection(),cursor:s.getCursor(),markerSet:r});let l,w;if(r)l=r.start.trim(),w=r.end.trim();else{let e=this.settings.template,t=e.indexOf("{cursor}"),a=e,i="";t!==-1&&(a=e.slice(0,t),i=e.slice(t+8)),l=a.trim(),w=i.trim()}function d(e){return e.replace(/\s+/g," ").trim()}let o=d(l),c=d(w);function k(e,t,a){let i=e.trim();return t&&a?i.startsWith(t)&&i.endsWith(a):t?i.startsWith(t):!1}function I(e){for(let t of K){let a=d(t.start),i=d(t.end);if(k(e,a,i))return{found:!0,markerStart:t.start,markerEnd:t.end}}return{found:!1}}let p=s.getSelection(),n=s.getCursor(),b=s.getCursor("from"),C=s.getCursor("to"),g=s.getLine(n.line),O,m=null;function B(e,t){let a=/[\p{L}\p{N}_]+/gu,i;for(;(i=a.exec(e))!==null;)if(t>=i.index&&t<=i.index+i[0].length)return{start:i.index,end:i.index+i[0].length};return null}p?O=p:(m=B(g,n.ch),m&&n.ch>m.start&&n.ch<m.end?(O=g.slice(m.start,m.end),b={line:n.line,ch:m.start},C={line:n.line,ch:m.end}):(O="",b={line:n.line,ch:n.ch},C={line:n.line,ch:n.ch}));function $(e,t){let a=t.indexOf(e);if(a!==-1)return{idx:a,full:!0};for(let i=e.length-1;i>0;i--){if(t.includes(e.slice(0,i)))return{idx:t.indexOf(e.slice(0,i)),full:!1};if(t.includes(e.slice(-i)))return{idx:t.indexOf(e.slice(-i)),full:!1}}return{idx:-1,full:!1}}function x(e,t,a){if(!e)return-1;if(a==="back"){for(let i=t;i>=0;i--)if(g.slice(i,i+e.length)===e)return i}else for(let i=t;i<=g.length-e.length;i++)if(g.slice(i,i+e.length)===e)return i;return-1}let f=-1,h=-1,T="",D=!1,S=o,M=c;if(p){let e=$(o,O),t=$(c,O);e.full&&t.full||e.idx!==-1||t.idx!==-1?(f=x(o,b.ch,"back"),h=x(c,C.ch,"forward")):(f=x(o,C.ch,"back"),h=x(c,b.ch,"forward"))}else m?(f=x(o,m.start,"back"),h=x(c,m.end,"forward")):(f=x(o,n.ch,"back"),h=x(c,n.ch,"forward"));if(f!==-1&&(!M||h!==-1&&f<h)){let e=f+o.length,t=M&&h!==-1?h:g.length;T=g.slice(e,t),k(g.slice(f,M&&h!==-1?h+c.length:g.length),o,c)&&(D=!0)}else{let e=I(g);if(e.found&&(S=e.markerStart?d(e.markerStart):"",M=e.markerEnd?d(e.markerEnd):"",f=x(S,n.ch,"back"),h=x(M,n.ch,"forward"),f!==-1&&(!M||h!==-1&&f<h))){let t=f+S.length,a=M&&h!==-1?h:g.length;T=g.slice(t,a),k(g.slice(f,M&&h!==-1?h+M.length:g.length),S,M)&&(D=!0)}}if(D){let e=g.slice(0,f),t=g.slice(M&&h!==-1?h+M.length:g.length);T.startsWith(" ")&&(T=T.slice(1)),T.endsWith(" ")&&(T=T.slice(0,-1));let a=e+T+t;s.setLine(n.line,a);let i=0;if(p){let y=e.length,R={line:n.line,ch:y},U={line:n.line,ch:y+T.length};s.setSelection(R,U)}else if(m){let y=e.length;s.setCursor({line:n.line,ch:y})}else{i=(n.ch>f?Math.min(n.ch,f+S.length)-f:0)+S.length;let y=n.ch-i;y<e.length&&(y=e.length),s.setCursor({line:n.line,ch:y})}_("Uncommented region",{from:b,to:C,region:T})}else{let e=O;!p&&!m&&!O.trim()&&(e="");let t,a;if(p){t=S+(e?" ":"")+e+(e?" ":"")+M,a=g.slice(0,b.ch)+t+g.slice(C.ch),s.setLine(n.line,a);let i={line:n.line,ch:b.ch+S.length+(e?1:0)},y={line:n.line,ch:b.ch+S.length+(e?1:0)+e.length};s.setSelection(i,y)}else if(m&&this.settings.wordOnlyMode){t=S+" "+g.slice(m.start,m.end)+" "+M,a=g.slice(0,m.start)+t+g.slice(m.end),s.setLine(n.line,a);let i={line:n.line,ch:m.start+S.length+1},y={line:n.line,ch:m.start+S.length+1+(m.end-m.start)};s.setSelection(i,y)}else m?(t=S+"  "+M,a=g.slice(0,n.ch)+t+g.slice(n.ch),s.setLine(n.line,a),s.setCursor({line:n.line,ch:n.ch+S.length+1})):(t=S+"  "+M,a=g.slice(0,n.ch)+t+g.slice(n.ch),s.setLine(n.line,a),s.setCursor({line:n.line,ch:n.ch+S.length+1}));_("Commented region",{from:b,to:C,commented:t})}function N(e){let t=s.getValue().split(`
`),a=Math.max(0,Math.min(e.line,t.length-1)),i=Math.max(0,Math.min(e.ch,t[a]?.length??0));return{line:a,ch:i}}let P=N(s.getCursor());(P.line!==s.getCursor().line||P.ch!==s.getCursor().ch)&&s.setCursor(P)}toggleCommentAtCursor(s){let r=this.settings.template,l=r.indexOf("{cursor}"),w=r,d="";l!==-1&&(w=r.slice(0,l),d=r.slice(l+8));let o=w.trim(),c=d.trim(),k=s.getCursor(),I=s.getLine(k.line),p=I.indexOf(o),n=c?I.lastIndexOf(c):-1,b=!1;if(o&&c?b=p!==-1&&n!==-1&&k.ch>=p+o.length&&k.ch<=n:o&&(b=p!==-1&&k.ch>=p+o.length),b){let C=I;o&&(C=C.replace(o,"")),c&&(C=C.replace(c,"")),C=C.trim(),s.setLine(k.line,C)}}};
//# sourceMappingURL=main.js.map
