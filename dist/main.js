"use strict";var K=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var te=Object.getOwnPropertyNames;var ne=Object.prototype.hasOwnProperty;var se=(T,t)=>{for(var r in t)K(T,r,{get:t[r],enumerable:!0})},le=(T,t,r,m)=>{if(t&&typeof t=="object"||typeof t=="function")for(let p of te(t))!ne.call(T,p)&&p!==r&&K(T,p,{get:()=>t[p],enumerable:!(m=ee(t,p))||m.enumerable});return T};var re=T=>le(K({},"__esModule",{value:!0}),T);var ie={};se(ie,{default:()=>z});module.exports=re(ie);var Y=require("obsidian");var X={template:"%% {cursor} %%",wordOnlyMode:!1};var U=require("obsidian"),q=class extends U.PluginSettingTab{constructor(t,r){super(t,r),this.plugin=r}display(){let{containerEl:t}=this;t.empty(),new U.Setting(t).setName("Comment Format").setDesc("Use {cursor} wherever you want the cursor to go (e.g. '%% {cursor} %%' or '<!-- {cursor} -->').").addTextArea(r=>r.setValue(this.plugin.settings.template).onChange(async m=>{this.plugin.settings.template=m||"%% {cursor} %%",await this.plugin.saveSettings()})),new U.Setting(t).setName("Word-only toggle mode").setDesc("If enabled, toggling will un/comment the word at the cursor's location rather than inserting a comment at the cursor position.").addToggle(r=>r.setValue(!!this.plugin.settings.wordOnlyMode).onChange(async m=>{this.plugin.settings.wordOnlyMode=m,await this.plugin.saveSettings()}))}};function j(...T){console.log("[CustomComment DEV]",...T)}var z=class extends Y.Plugin{async onload(){await this.loadSettings(),this.addSettingTab(new q(this.app,this)),this.addCommand({id:"toggle-comment-template",name:"Toggle Comment",editorCallback:t=>this.toggleComment(t)})}async loadSettings(){this.settings=Object.assign({},X,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}insertComment(t){let r=this.settings.template,m=r.indexOf("{cursor}");if(m===-1){t.replaceSelection(r);return}let p=r.slice(0,m),v=r.slice(m+8),x=t.getCursor();t.replaceSelection(p+v);let o=p.split(`
`),g=o.length-1,E=o[o.length-1].length;t.setCursor({line:x.line+g,ch:(g?0:x.ch)+E})}toggleComment(t){j("toggleComment called",{selection:t.getSelection(),cursor:t.getCursor()});function r(e){let l=t.getValue().split(`
`),n=Math.max(0,Math.min(e.line,l.length-1)),i=Math.max(0,Math.min(e.ch,l[n]?.length??0));return{line:n,ch:i}}let m=this.settings.template,p=m.indexOf("{cursor}"),v=m,x="";p!==-1&&(v=m.slice(0,p),x=m.slice(p+8));let o=v,g=x,E=[{start:"%%",end:"%%"},{start:"<!--",end:"-->"},{start:"//",end:""}],c=t.getSelection(),s=t.getCursor(),u,h=t.getCursor("from"),w=t.getCursor("to"),a=null,b=t.getLine(s.line);function Z(e,l){let n=/[\p{L}\p{N}_]+/gu,i;for(;(i=n.exec(e))!==null;)if(l>=i.index&&l<=i.index+i[0].length)return{start:i.index,end:i.index+i[0].length};return null}function Q(e,l,n){return l?n?e.startsWith(l)&&e.endsWith(n):e.startsWith(l):!1}function B(e,l,n,i,N,G){let _=i.trim(),R=N.trim();if(G==="back")for(let f=l;f>=0;f--){let W=e[f],A=f===l?n:W.length;for(let d=A-1;d>=0;d--){if(W.substr(d,_.length)===_)return{type:"marker",pos:{line:f,ch:d}};if(W.substr(d,R.length)===R)return{type:"opposite",pos:{line:f,ch:d}}}}else for(let f=l;f<e.length;f++){let W=e[f],A=f===l?n:0;for(let d=A;d<=W.length-Math.min(_.length,R.length);d++){if(W.substr(d,_.length)===_)return{type:"marker",pos:{line:f,ch:d}};if(W.substr(d,R.length)===R)return{type:"opposite",pos:{line:f,ch:d}}}}return{type:null,pos:null}}let P=!1,k=null,L=null,M=t.getValue().split(`
`);if(o&&g){let e,l;if(c){let n=B(M,h.line,h.ch,o,g,"back"),i=B(M,w.line,w.ch,g,o,"forward");e=n.type,l=i.type,e==="marker"&&(k=n.pos),l==="marker"&&(L=i.pos)}else{let n=B(M,s.line,s.ch,o,g,"back"),i=B(M,s.line,s.ch,g,o,"forward");e=n.type,l=i.type,e==="marker"&&(k=n.pos),l==="marker"&&(L=i.pos)}e==="marker"&&l==="marker"?P=!0:P=!1}if(j("comment:",P,{start:k?{line:k.line+1,ch:k.ch+1}:null,end:L?{line:L.line+1,ch:L.ch+1}:null}),P&&k&&L){let e=M[k.line];M[k.line]=e.slice(0,k.ch)+e.slice(k.ch+o.length);let l=L.line,n=L.ch;k.line===L.line&&(n-=o.length);let i=M[l],N=0;n>0&&i[n-1]===" "&&(n--,N=1),M[l]=i.slice(0,n)+i.slice(n+g.length);let G=Math.min(k.line,L.line),_=Math.max(k.line,L.line),R=M.slice(G,_+1).join(`
`);t.replaceRange(R,{line:G,ch:0},{line:_,ch:t.getLine(_).length});let f=h.line,W=h.ch-o.length;W<0&&(W=0);let A=M.length-1;f>A&&(f=A);let d=M[f]?.length??0;W>d&&(W=d);let $=r({line:f,ch:W});t.setCursor($);return}let O=!1;a=Z(b,s.ch),c?O=!1:a&&(s.ch>a.start&&s.ch<a.end||this.settings.wordOnlyMode&&(s.ch===a.start||s.ch===a.end)?O=!0:O=!1),j("Mode:",c?"selection":O?"word":"insert",{selection:c,wordBounds:a,useWord:O}),c?u=c:O&&a?(u=b.slice(a.start,a.end),h={line:s.line,ch:a.start},w={line:s.line,ch:a.end}):(u="",h={line:s.line,ch:s.ch},w={line:s.line,ch:s.ch});let C=v,S=x,y=!1,F=u;if(c){if(C&&S&&c.startsWith(C)&&c.endsWith(S))y=!0,F=c;else for(let e of E)if(e.start&&e.end&&c.startsWith(e.start)&&c.endsWith(e.end)){C=e.start,S=e.end,y=!0,F=c;break}if(!y){let e=t.getLine(h.line),l=t.getLine(w.line);if(C&&S&&e.startsWith(C)&&l.endsWith(S))y=!0,F=t.getRange({line:h.line,ch:0},{line:w.line,ch:t.getLine(w.line).length});else for(let n of E)if(n.start&&n.end&&e.startsWith(n.start)&&l.endsWith(n.end)){C=n.start,S=n.end,y=!0,F=t.getRange({line:h.line,ch:0},{line:w.line,ch:t.getLine(w.line).length});break}}}else if(O&&a){if(C&&S&&b.startsWith(C)&&b.endsWith(S))y=!0,F=b;else for(let e of E)if(e.start&&e.end&&b.startsWith(e.start)&&b.endsWith(e.end)){C=e.start,S=e.end,y=!0,F=b;break}if(!y&&C&&S&&u.startsWith(C)&&u.endsWith(S))y=!0,F=u;else if(!y){for(let e of E)if(e.start&&e.end&&u.startsWith(e.start)&&u.endsWith(e.end)){C=e.start,S=e.end,y=!0,F=u;break}}}else if(C&&S&&b.startsWith(C)&&b.endsWith(S))y=!0,F=b;else for(let e of E)if(e.start&&e.end&&b.startsWith(e.start)&&b.endsWith(e.end)){C=e.start,S=e.end,y=!0,F=b;break}function oe(e,l,n,i,N){return{result:e,newStart:i,newEnd:N}}if(y)return;let I=o,V=g,H=!1,D=u;if(c?D=u:O&&a?D=b.slice(a.start,a.end):D=u,I&&Q(D,I,V))H=!0;else for(let e of E)if(e.start&&Q(D,e.start,e.end)){I=e.start,V=e.end,H=!0;break}if(H){j("Removing exact comment markers",{usedStart:I,usedEnd:V,checkText:D});let e=D,l=0;if(I&&e.startsWith(I)&&(l=I.length,e=e.slice(I.length)),V&&e.endsWith(V)&&(e=e.slice(0,-V.length)),c){t.replaceSelection(e);let n=r(h),i=r({line:w.line,ch:w.ch-l});t.setSelection(n,i)}else if(O&&a){t.replaceRange(e,{line:s.line,ch:a.start},{line:s.line,ch:a.end});let n=Math.max(a.start,s.ch-l),i=r({line:s.line,ch:n});t.setCursor(i)}else{t.replaceRange(e,{line:s.line,ch:s.ch},{line:s.line,ch:s.ch});let n=r({line:s.line,ch:s.ch});t.setCursor(n)}}else{j("Adding comment markers",{markerStart:o,markerEnd:g,text:u});let e=o+u+g;if(c){t.replaceSelection(e);let l=o.length,n=r({line:h.line,ch:h.ch+l}),i=r({line:w.line,ch:w.ch+l});t.setSelection(n,i)}else if(O&&a){t.replaceRange(e,{line:s.line,ch:a.start},{line:s.line,ch:a.end});let l=s.ch+o.length,n=r({line:s.line,ch:l});t.setCursor(n)}else{t.replaceRange(e,{line:s.line,ch:s.ch},{line:s.line,ch:s.ch});let l=r({line:s.line,ch:s.ch+o.length});t.setCursor(l)}}let J=r(t.getCursor());(J.line!==t.getCursor().line||J.ch!==t.getCursor().ch)&&t.setCursor(J)}toggleCommentAtCursor(t){let r=this.settings.template,m=r.indexOf("{cursor}"),p=r,v="";m!==-1&&(p=r.slice(0,m),v=r.slice(m+8));let x=p.trim(),o=v.trim(),g=t.getCursor(),E=t.getLine(g.line),c=E.indexOf(x),s=o?E.lastIndexOf(o):-1,u=!1;if(x&&o?u=c!==-1&&s!==-1&&g.ch>=c+x.length&&g.ch<=s:x&&(u=c!==-1&&g.ch>=c+x.length),u){let h=E;x&&(h=h.replace(x,"")),o&&(h=h.replace(o,"")),h=h.trim(),t.setLine(g.line,h)}}};
//# sourceMappingURL=main.js.map
