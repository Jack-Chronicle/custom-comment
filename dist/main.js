"use strict";var H=Object.defineProperty;var Y=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var ee=Object.prototype.hasOwnProperty;var te=(x,f)=>{for(var t in f)H(x,t,{get:f[t],enumerable:!0})},ne=(x,f,t,o)=>{if(f&&typeof f=="object"||typeof f=="function")for(let r of Z(f))!ee.call(x,r)&&r!==t&&H(x,r,{get:()=>f[r],enumerable:!(o=Y(f,r))||o.enumerable});return x};var se=x=>ne(H({},"__esModule",{value:!0}),x);var ie={};te(ie,{default:()=>G});module.exports=se(ie);var Q=require("obsidian");var K={template:"%% {cursor} %%",wordOnlyMode:!1,additionalMarkers:[]};var A=require("obsidian"),j=class extends A.PluginSettingTab{constructor(f,t){super(f,t),this.plugin=t}display(){let{containerEl:f}=this;f.empty(),new A.Setting(f).setName("Comment Format").setDesc("Use {cursor} wherever you want the cursor to go (e.g. '%% {cursor} %%' or '<!-- {cursor} -->').").addText(o=>o.setValue(this.plugin.settings.template).onChange(async r=>{this.plugin.settings.template=r||"%% {cursor} %%",await this.plugin.saveSettings()})),new A.Setting(f).setName("Word-only toggle mode").setDesc("If enabled, toggling will un/comment the word at the cursor's location rather than inserting a comment at the cursor position.").addToggle(o=>o.setValue(!!this.plugin.settings.wordOnlyMode).onChange(async r=>{this.plugin.settings.wordOnlyMode=r,await this.plugin.saveSettings()})),f.createEl("h3",{text:"Additional Marker Sets"}),(this.plugin.settings.additionalMarkers||[]).forEach((o,r)=>{let m=new A.Setting(f).setName(`Marker Set ${r+1}`).addToggle(h=>h.setValue(!!o.registerCommand).onChange(async l=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[r].registerCommand=l,await this.plugin.saveSettings(),this.plugin.registerMarkerCommands(!0),this.display())})).addText(h=>h.setPlaceholder("Start marker").setValue(o.start).onChange(async l=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[r].start=l,await this.plugin.saveSettings())})).addText(h=>h.setPlaceholder("End marker").setValue(o.end).onChange(async l=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[r].end=l,await this.plugin.saveSettings())})).addExtraButton(h=>h.setIcon("cross").setTooltip("Remove marker set").onClick(async()=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers.splice(r,1),await this.plugin.saveSettings(),this.display())}))}),new A.Setting(f).addButton(o=>o.setButtonText("Add Marker Set").setCta().onClick(async()=>{this.plugin.settings.additionalMarkers||(this.plugin.settings.additionalMarkers=[]),this.plugin.settings.additionalMarkers.push({start:"",end:"",registerCommand:!1}),await this.plugin.saveSettings(),this.display()}))}};function $(...x){console.log("[CustomComment DEV]",...x)}var V=[{start:"%%",end:"%%"},{start:"<!--",end:"-->"},{start:"//",end:""}],G=class extends Q.Plugin{constructor(){super(...arguments);this._markerCommandIds=[]}async onload(){await this.loadSettings(),this.addSettingTab(new j(this.app,this)),this.addCommand({id:"reload-marker-commands",name:"Reload Marker Commands",callback:()=>this.registerMarkerCommands(!0)}),this.registerMarkerCommands()}registerMarkerCommands(t=!1){t&&this._markerCommandIds&&(this._markerCommandIds=[]),this._markerCommandIds=[];let o=this.settings.template??"%% {cursor} %%",r=o.indexOf("{cursor}"),m="%%",h="%%";r!==-1&&(m=o.slice(0,r).trim()||"%%",h=o.slice(r+8).trim()||"%%");let l="toggle-comment-template";this.addCommand({id:l,name:`Toggle Comment: (${m}|${h})`,editorCallback:n=>this.toggleComment(n)}),this._markerCommandIds.push(l),Array.isArray(this.settings.additionalMarkers)&&this.settings.additionalMarkers.forEach((n,g)=>{if(n&&n.registerCommand){let u=`toggle-comment-marker-set-${g+1}`;this.addCommand({id:u,name:(()=>{let d=n.start?.trim()||"%%",c=n.end?.trim()||"%%";return`Toggle Marker ${g+1}: (${d}|${c})`})(),checkCallback:(d,c)=>(!d&&c&&this.toggleComment(c,n),!0)}),this._markerCommandIds.push(u)}})}async loadSettings(){this.settings=Object.assign({},K,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async reloadPlugin(){await this.app.plugins.disablePlugin(this.manifest.id),await this.app.plugins.enablePlugin(this.manifest.id)}insertComment(t){let o=this.settings.template,r=o.indexOf("{cursor}");if(r===-1){t.replaceSelection(o);return}let m=o.slice(0,r),h=o.slice(r+8),l=t.getCursor();t.replaceSelection(m+h);let n=m.split(`
`),g=n.length-1,u=n[n.length-1].length;t.setCursor({line:l.line+g,ch:(g?0:l.ch)+u})}toggleComment(t,o){$("toggleComment called",{selection:t.getSelection(),cursor:t.getCursor(),markerSet:o});function r(e){let i=t.getValue().split(`
`),s=Math.max(0,Math.min(e.line,i.length-1)),a=Math.max(0,Math.min(e.ch,i[s]?.length??0));return{line:s,ch:a}}let m,h;if(o)m=o.start,h=o.end;else{let e=this.settings.template,i=e.indexOf("{cursor}"),s=e,a="";i!==-1&&(s=e.slice(0,i),a=e.slice(i+8)),m=s,h=a}let l=t.getSelection(),n=t.getCursor(),g,u=t.getCursor("from"),d=t.getCursor("to"),c=null,p=t.getLine(n.line);function v(e,i){let s=/[\p{L}\p{N}_]+/gu,a;for(;(a=s.exec(e))!==null;)if(i>=a.index&&i<=a.index+a[0].length)return{start:a.index,end:a.index+a[0].length};return null}function J(e,i,s){return i?s?e.startsWith(i)&&e.endsWith(s):e.startsWith(i):!1}function B(e,i,s,a,N,U){let _=a.trim(),F=N.trim();if(U==="back")for(let C=i;C>=0;C--){let w=e[C],P=C===i?s:w.length;for(let k=P-1;k>=0;k--){if(w.substr(k,_.length)===_)return{type:"marker",pos:{line:C,ch:k}};if(w.substr(k,F.length)===F)return{type:"opposite",pos:{line:C,ch:k}}}}else for(let C=i;C<e.length;C++){let w=e[C],P=C===i?s:0;for(let k=P;k<=w.length-Math.min(_.length,F.length);k++){if(w.substr(k,_.length)===_)return{type:"marker",pos:{line:C,ch:k}};if(w.substr(k,F.length)===F)return{type:"opposite",pos:{line:C,ch:k}}}}return{type:null,pos:null}}let R=!1,M=null,E=null,W=t.getValue().split(`
`);if(m&&h){let e,i;if(l){let s=B(W,u.line,u.ch,m,h,"back"),a=B(W,d.line,d.ch,h,m,"forward");e=s.type,i=a.type,e==="marker"&&(M=s.pos),i==="marker"&&(E=a.pos)}else{let s=B(W,n.line,n.ch,m,h,"back"),a=B(W,n.line,n.ch,h,m,"forward");e=s.type,i=a.type,e==="marker"&&(M=s.pos),i==="marker"&&(E=a.pos)}e==="marker"&&i==="marker"?R=!0:R=!1}if($("comment:",R,{start:M?{line:M.line+1,ch:M.ch+1}:null,end:E?{line:E.line+1,ch:E.ch+1}:null}),R&&M&&E){let e=W[M.line];W[M.line]=e.slice(0,M.ch)+e.slice(M.ch+m.length);let i=E.line,s=E.ch;M.line===E.line&&(s-=m.length);let a=W[i],N=0;s>0&&a[s-1]===" "&&(s--,N=1),W[i]=a.slice(0,s)+a.slice(s+h.length);let U=Math.min(M.line,E.line),_=Math.max(M.line,E.line),F=W.slice(U,_+1).join(`
`);t.replaceRange(F,{line:U,ch:0},{line:_,ch:t.getLine(_).length});let C=u.line,w=u.ch-m.length;w<0&&(w=0);let P=W.length-1;C>P&&(C=P);let k=W[C]?.length??0;w>k&&(w=k);let X=r({line:C,ch:w});t.setCursor(X);return}let T=!1;c=v(p,n.ch),l?T=!1:c&&(n.ch>c.start&&n.ch<c.end||this.settings.wordOnlyMode&&(n.ch===c.start||n.ch===c.end)?T=!0:T=!1),$("Mode:",l?"selection":T?"word":"insert",{selection:l,wordBounds:c,useWord:T}),l?g=l:T&&c?(g=p.slice(c.start,c.end),u={line:n.line,ch:c.start},d={line:n.line,ch:c.end}):(g="",u={line:n.line,ch:n.ch},d={line:n.line,ch:n.ch});let b=m,y=h,S=!1,I=g;if(l){if(b&&y&&l.startsWith(b)&&l.endsWith(y))S=!0,I=l;else for(let e of V)if(e.start&&e.end&&l.startsWith(e.start)&&l.endsWith(e.end)){b=e.start,y=e.end,S=!0,I=l;break}if(!S){let e=t.getLine(u.line),i=t.getLine(d.line);if(b&&y&&e.startsWith(b)&&i.endsWith(y))S=!0,I=t.getRange({line:u.line,ch:0},{line:d.line,ch:t.getLine(d.line).length});else for(let s of V)if(s.start&&s.end&&e.startsWith(s.start)&&i.endsWith(s.end)){b=s.start,y=s.end,S=!0,I=t.getRange({line:u.line,ch:0},{line:d.line,ch:t.getLine(d.line).length});break}}}else if(T&&c){if(b&&y&&p.startsWith(b)&&p.endsWith(y))S=!0,I=p;else for(let e of V)if(e.start&&e.end&&p.startsWith(e.start)&&p.endsWith(e.end)){b=e.start,y=e.end,S=!0,I=p;break}if(!S&&b&&y&&g.startsWith(b)&&g.endsWith(y))S=!0,I=g;else if(!S){for(let e of V)if(e.start&&e.end&&g.startsWith(e.start)&&g.endsWith(e.end)){b=e.start,y=e.end,S=!0,I=g;break}}}else if(b&&y&&p.startsWith(b)&&p.endsWith(y))S=!0,I=p;else for(let e of V)if(e.start&&e.end&&p.startsWith(e.start)&&p.endsWith(e.end)){b=e.start,y=e.end,S=!0,I=p;break}function re(e,i,s,a,N){return{result:e,newStart:a,newEnd:N}}if(S)return;let L=m,D=h,q=!1,O=g;if(l?O=g:T&&c?O=p.slice(c.start,c.end):O=g,L&&J(O,L,D))q=!0;else for(let e of V)if(e.start&&J(O,e.start,e.end)){L=e.start,D=e.end,q=!0;break}if(q){$("Removing exact comment markers",{usedStart:L,usedEnd:D,checkText:O});let e=O,i=0;if(L&&e.startsWith(L)&&(i=L.length,e=e.slice(L.length)),D&&e.endsWith(D)&&(e=e.slice(0,-D.length)),l){t.replaceSelection(e);let s=r(u),a=r({line:d.line,ch:d.ch-i});t.setSelection(s,a)}else if(T&&c){t.replaceRange(e,{line:n.line,ch:c.start},{line:n.line,ch:c.end});let s=Math.max(c.start,n.ch-i),a=r({line:n.line,ch:s});t.setCursor(a)}else{t.replaceRange(e,{line:n.line,ch:n.ch},{line:n.line,ch:n.ch});let s=r({line:n.line,ch:n.ch});t.setCursor(s)}}else{$("Adding comment markers",{markerStart:m,markerEnd:h,text:g});let e=m+g+h;if(l){t.replaceSelection(e);let i=m.length,s=r({line:u.line,ch:u.ch+i}),a=r({line:d.line,ch:d.ch+i});t.setSelection(s,a)}else if(T&&c){t.replaceRange(e,{line:n.line,ch:c.start},{line:n.line,ch:c.end});let i=n.ch+m.length,s=r({line:n.line,ch:i});t.setCursor(s)}else{t.replaceRange(e,{line:n.line,ch:n.ch},{line:n.line,ch:n.ch});let i=r({line:n.line,ch:n.ch+m.length});t.setCursor(i)}}let z=r(t.getCursor());(z.line!==t.getCursor().line||z.ch!==t.getCursor().ch)&&t.setCursor(z)}toggleCommentAtCursor(t){let o=this.settings.template,r=o.indexOf("{cursor}"),m=o,h="";r!==-1&&(m=o.slice(0,r),h=o.slice(r+8));let l=m.trim(),n=h.trim(),g=t.getCursor(),u=t.getLine(g.line),d=u.indexOf(l),c=n?u.lastIndexOf(n):-1,p=!1;if(l&&n?p=d!==-1&&c!==-1&&g.ch>=d+l.length&&g.ch<=c:l&&(p=d!==-1&&g.ch>=d+l.length),p){let v=u;l&&(v=v.replace(l,"")),n&&(v=v.replace(n,"")),v=v.trim(),t.setLine(g.line,v)}}};
//# sourceMappingURL=main.js.map
