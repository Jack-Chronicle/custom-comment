"use strict";var q=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(P,k)=>{for(var n in k)q(P,n,{get:k[n],enumerable:!0})},ee=(P,k,n,o)=>{if(k&&typeof k=="object"||typeof k=="function")for(let c of X(k))!Y.call(P,c)&&c!==n&&q(P,c,{get:()=>k[c],enumerable:!(o=Q(k,c))||o.enumerable});return P};var te=P=>ee(q({},"__esModule",{value:!0}),P);var ie={};Z(ie,{default:()=>G});module.exports=te(ie);var H=require("obsidian");var z={template:"%% {cursor} %%",wordOnlyMode:!1,additionalMarkers:[]};var A=require("obsidian"),U=class extends A.PluginSettingTab{constructor(k,n){super(k,n),this.plugin=n}display(){let{containerEl:k}=this;k.empty(),new A.Setting(k).setName("Comment Format").setDesc("Use {cursor} wherever you want the cursor to go (e.g. '%% {cursor} %%' or '<!-- {cursor} -->').").addText(o=>o.setValue(this.plugin.settings.template).onChange(async c=>{this.plugin.settings.template=c||"%% {cursor} %%",await this.plugin.saveSettings()})),new A.Setting(k).setName("Word-only toggle mode").setDesc("If enabled, toggling will un/comment the word at the cursor's location rather than inserting a comment at the cursor position.").addToggle(o=>o.setValue(!!this.plugin.settings.wordOnlyMode).onChange(async c=>{this.plugin.settings.wordOnlyMode=c,await this.plugin.saveSettings()})),k.createEl("h3",{text:"Additional Marker Sets"}),(this.plugin.settings.additionalMarkers||[]).forEach((o,c)=>{let y=new A.Setting(k).setName(`Marker Set ${c+1}`).addToggle(u=>u.setValue(!!o.registerCommand).onChange(async s=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].registerCommand=s,await this.plugin.saveSettings(),this.plugin.registerMarkerCommands(!0),this.display())})).addText(u=>u.setPlaceholder("Start marker").setValue(o.start).onChange(async s=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].start=s,await this.plugin.saveSettings())})).addText(u=>u.setPlaceholder("End marker").setValue(o.end).onChange(async s=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].end=s,await this.plugin.saveSettings())})).addExtraButton(u=>u.setIcon("cross").setTooltip("Remove marker set").onClick(async()=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers.splice(c,1),await this.plugin.saveSettings(),this.display())}))}),new A.Setting(k).addButton(o=>o.setButtonText("Add Marker Set").setCta().onClick(async()=>{this.plugin.settings.additionalMarkers||(this.plugin.settings.additionalMarkers=[]),this.plugin.settings.additionalMarkers.push({start:"",end:"",registerCommand:!1}),await this.plugin.saveSettings(),this.display()}))}};function m(...P){console.log("[CustomComment DEV]",...P)}var ne=[{start:"%%",end:"%%"},{start:"<!--",end:"-->"},{start:"//",end:""}],G=class extends H.Plugin{constructor(){super(...arguments);this._markerCommandIds=[];this._cleanupGuard=!1}async onload(){m("Plugin loading..."),await this.loadSettings(),this.addSettingTab(new U(this.app,this)),this.addCommand({id:"reload-marker-commands",name:"Reload Marker Commands",callback:()=>this.registerMarkerCommands(!0)}),this.registerMarkerCommands()}registerMarkerCommands(n=!1){n&&this._markerCommandIds&&(this._markerCommandIds=[]),this._markerCommandIds=[];let o=this.settings.template??"%% {cursor} %%",c=o.indexOf("{cursor}"),y="%%",u="%%";c!==-1&&(y=o.slice(0,c).trim()||"%%",u=o.slice(c+8).trim()||"%%");let s="toggle-comment-template";this.addCommand({id:s,name:`Toggle Comment: (${y}|${u})`,editorCallback:r=>this.toggleComment(r)}),this._markerCommandIds.push(s),Array.isArray(this.settings.additionalMarkers)&&this.settings.additionalMarkers.forEach((r,w)=>{if(r&&r.registerCommand){let D=`toggle-comment-marker-set-${w+1}`;this.addCommand({id:D,name:(()=>{let p=r.start?.trim()||"%%",v=r.end?.trim()||"%%";return`Toggle Marker ${w+1}: (${p}|${v})`})(),checkCallback:(p,v)=>(!p&&v&&this.toggleComment(v,r),!0)}),this._markerCommandIds.push(D)}}),m("Marker commands registered:",this._markerCommandIds)}async loadSettings(){this.settings=Object.assign({},z,await this.loadData()),m("Settings loaded:",this.settings)}async saveSettings(){await this.saveData(this.settings),m("Settings saved:",this.settings)}async reloadPlugin(){await this.app.plugins.disablePlugin(this.manifest.id),await this.app.plugins.enablePlugin(this.manifest.id),m("Plugin reloaded")}insertComment(n){let o=this.settings.template,c=o.indexOf("{cursor}");if(c===-1){n.replaceSelection(o),m("Inserted template (no cursor placeholder)");return}let y=o.slice(0,c).trim(),u=o.slice(c+8).trim(),s=`${y} ${u}`.replace(/\s+/g," ").trim(),r=n.getCursor();n.replaceSelection(`${y}  ${u}`.replace(/\s+/g," ").replace(" "," {cursor} "));let w=y.split(`
`),D=w.length-1,p=w[w.length-1].length+1;n.setCursor({line:r.line+D,ch:(D?0:r.ch)+p}),m("Inserted comment at cursor")}toggleComment(n,o){m("toggleComment called",{selection:n.getSelection(),cursor:n.getCursor(),markerSet:o});let c,y;if(o)c=o.start.trim(),y=o.end.trim();else{let e=this.settings.template,t=e.indexOf("{cursor}"),l=e,a="";t!==-1&&(l=e.slice(0,t),a=e.slice(t+8)),c=l.trim(),y=a.trim()}function u(e){return e.replace(/\s+/g," ").trim()}let s=u(c),r=u(y);function w(e,t){let l=t.indexOf(e);if(l!==-1)return{idx:l,full:!0};for(let a=e.length-1;a>0;a--){if(t.includes(e.slice(0,a)))return{idx:t.indexOf(e.slice(0,a)),full:!1,partial:e.slice(0,a)};if(t.includes(e.slice(-a)))return{idx:t.indexOf(e.slice(-a)),full:!1,partial:e.slice(-a)}}return{idx:-1,full:!1}}function D({line:e,marker:t,partialIdx:l,isStart:a,otherMarker:$,uniqueMarkers:E=!0}){let I=t.length,_=-1;for(let x=Math.max(0,l-I+1);x<=l;x++)if(e.slice(x,x+I)===t){_=x;break}if(_===-1){for(let x=l;x<=Math.min(e.length-I,l+I-1);x++)if(e.slice(x,x+I)===t){_=x;break}}if(_===-1)return{confirmed:!1};if(a){let x=e.indexOf($,_+I);if(x===-1)return{confirmed:!1};if(E){let B=e.indexOf(t,_+I);if(B!==-1&&B<x)return{confirmed:!1}}return{confirmed:!0,startIdx:_,endIdx:x}}else{let x=e.lastIndexOf($,_-1);if(x===-1)return{confirmed:!1};if(E){let B=e.lastIndexOf(t,_-1);if(B!==-1&&B>x)return{confirmed:!1}}return{confirmed:!0,startIdx:x,endIdx:_}}}function p(e,t,l){return l==="back"?d.lastIndexOf(e,t):d.indexOf(e,t)}function v(e,t,l){let a=e.trim();return t&&l?a.startsWith(t)&&a.endsWith(l):t?a.startsWith(t):!1}function W(e){for(let t of ne){let l=u(t.start),a=u(t.end);if(v(e,l,a))return{found:!0,markerStart:t.start,markerEnd:t.end}}return{found:!1}}let M=n.getSelection(),i=n.getCursor(),b=n.getCursor("from"),T=n.getCursor("to"),d=n.getLine(i.line),F,h=null;function J(e,t){let l=/[\p{L}\p{N}_]+/gu,a;for(;(a=l.exec(e))!==null;)if(t>=a.index&&t<=a.index+a[0].length)return{start:a.index,end:a.index+a[0].length};return null}M?F=M:(h=J(d,i.ch),h&&i.ch>h.start&&i.ch<h.end?(F=d.slice(h.start,h.end),b={line:i.line,ch:h.start},T={line:i.line,ch:h.end}):(F="",b={line:i.line,ch:i.ch},T={line:i.line,ch:i.ch}));let f=-1,g=-1,O="",N=!1,S=s,C=r,R=!!(S&&C&&S!==C);m("[Detection] selection:",M),m("[Detection] text:",F);let L=w(s,F),V=w(r,F);if(m("[Detection] foundStart:",L),m("[Detection] foundEnd:",V),M)if(L.full&&V.full)m("[Detection] Both full markers found in selection."),f=p(s,T.ch,"back"),g=p(r,b.ch,"forward");else if(L.full){m("[Detection] Only full start marker found in selection.");let e=F.indexOf(s);e!==-1&&(f=b.ch+e,g=p(r,f+s.length,"forward"))}else if(V.full){m("[Detection] Only full end marker found in selection.");let e=F.indexOf(r);e!==-1&&(g=b.ch+e,f=p(s,g,"back"))}else if(L.idx!==-1&&!L.full){m("[Detection] Partial start marker found in selection.");let e=D({line:d,marker:s,partialIdx:b.ch+L.idx,isStart:!0,otherMarker:r,uniqueMarkers:R});if(m("[Detection] confirmPartialMarker result (start):",e),e.confirmed&&e.startIdx!==void 0&&e.endIdx!==void 0)f=e.startIdx,g=e.endIdx;else if(L.partial&&r.startsWith(L.partial)){m("[Detection] Partial start marker did not confirm, trying as partial end marker.");let t=D({line:d,marker:r,partialIdx:b.ch+L.idx,isStart:!1,otherMarker:s,uniqueMarkers:R});m("[Detection] confirmPartialMarker result (as end):",t),t.confirmed&&t.startIdx!==void 0&&t.endIdx!==void 0&&(f=t.startIdx,g=t.endIdx)}}else if(V.idx!==-1&&!V.full){m("[Detection] Partial end marker found in selection.");let e=D({line:d,marker:r,partialIdx:T.ch+V.idx,isStart:!1,otherMarker:s,uniqueMarkers:R});if(m("[Detection] confirmPartialMarker result (end):",e),e.confirmed&&e.startIdx!==void 0&&e.endIdx!==void 0)f=e.startIdx,g=e.endIdx;else if(V.partial&&s.startsWith(V.partial)){m("[Detection] Partial end marker did not confirm, trying as partial start marker.");let t=D({line:d,marker:s,partialIdx:T.ch+V.idx,isStart:!0,otherMarker:r,uniqueMarkers:R});m("[Detection] confirmPartialMarker result (as start):",t),t.confirmed&&t.startIdx!==void 0&&t.endIdx!==void 0&&(f=t.startIdx,g=t.endIdx)}}else m("[Detection] No marker found in selection, searching line."),f=p(s,T.ch,"back"),g=p(r,b.ch,"forward");else if(h)f=p(s,h.start,"back"),g=p(r,h.end,"forward");else if(f=p(s,i.ch,"back"),g=p(r,i.ch,"forward"),!M&&!h&&!F.trim()&&s&&r){let e=d.indexOf(s),t=r?d.lastIndexOf(r):-1;e!==-1&&t!==-1&&i.ch>=e+s.length&&i.ch<=t+r.length&&(f=e,g=t)}if(m("[Detection] startIdx:",f,"endIdx:",g),m("[Detection] region:",O),m("[Detection] regionIsComment:",N),f!==-1&&(!C||g!==-1&&f<g)){let e=f+s.length,t=C&&g!==-1?g:d.length;O=d.slice(e,t),v(d.slice(f,C&&g!==-1?g+r.length:d.length),s,r)&&(N=!0)}else{let e=W(d);if(e.found&&(S=e.markerStart?u(e.markerStart):"",C=e.markerEnd?u(e.markerEnd):"",f=p(S,i.ch,"back"),g=p(C,i.ch,"forward"),f!==-1&&(!C||g!==-1&&f<g))){let t=f+S.length,l=C&&g!==-1?g:d.length;O=d.slice(t,l),v(d.slice(f,C&&g!==-1?g+C.length:d.length),S,C)&&(N=!0)}}if(N){let e=d.slice(0,f),t=d.slice(C&&g!==-1?g+C.length:d.length),l=0;O.startsWith(" ")&&(O=O.slice(1),l=1);let a=0;O.endsWith(" ")&&(O=O.slice(0,-1),a=1);let $=e+O+t;if(n.setLine(i.line,$),M){let E=b.ch,I=T.ch;b.ch<=f+S.length+l?E=f:E=b.ch-S.length-l,C&&g!==-1&&T.ch>=g?I=f+O.length:I=T.ch-S.length-l,E=Math.max(0,E),I=Math.max(E,I);let _={line:i.line,ch:E},x={line:i.line,ch:I};n.setSelection(_,x)}else if(h){let E={line:i.line,ch:e.length},I={line:i.line,ch:e.length+O.length};n.setSelection(E,I)}else{let E={line:i.line,ch:e.length},I={line:i.line,ch:e.length+O.length};n.setSelection(E,I)}m("Uncommented region",{from:b,to:T,region:O})}else{let e=F;!M&&!h&&!F.trim()&&(e="");let t,l;if(M){t=S+(e?" ":"")+e+(e?" ":"")+C,l=d.slice(0,b.ch)+t+d.slice(T.ch),n.setLine(i.line,l);let a=S.length+(e?1:0),$={line:i.line,ch:b.ch+a},E={line:i.line,ch:b.ch+a+e.length};n.setSelection($,E)}else if(h&&this.settings.wordOnlyMode){t=S+" "+d.slice(h.start,h.end)+" "+C,l=d.slice(0,h.start)+t+d.slice(h.end),n.setLine(i.line,l);let a={line:i.line,ch:h.start+S.length+1},$={line:i.line,ch:h.start+S.length+1+(h.end-h.start)};n.setSelection(a,$)}else h?(t=S+"  "+C,l=d.slice(0,i.ch)+t+d.slice(i.ch),n.setLine(i.line,l),n.setCursor({line:i.line,ch:i.ch+S.length+1})):(t=S+"  "+C,l=d.slice(0,i.ch)+t+d.slice(i.ch),n.setLine(i.line,l),n.setCursor({line:i.line,ch:i.ch+S.length+1}));m("Commented region",{from:b,to:T,commented:t})}function K(e){let t=n.getValue().split(`
`),l=Math.max(0,Math.min(e.line,t.length-1)),a=Math.max(0,Math.min(e.ch,t[l]?.length??0));return{line:l,ch:a}}let j=K(n.getCursor());(j.line!==n.getCursor().line||j.ch!==n.getCursor().ch)&&n.setCursor(j)}toggleCommentAtCursor(n){let o=this.settings.template,c=o.indexOf("{cursor}"),y=o,u="";c!==-1&&(y=o.slice(0,c),u=o.slice(c+8));let s=y.trim(),r=u.trim(),w=n.getCursor(),D=n.getLine(w.line),p=D.indexOf(s),v=r?D.lastIndexOf(r):-1,W=!1;if(s&&r?W=p!==-1&&v!==-1&&w.ch>=p+s.length&&w.ch<=v+r.length:s&&(W=p!==-1&&w.ch>=p+s.length),W){let M=D;s&&(M=M.replace(s,"")),r&&(M=M.replace(r,"")),M=M.trim(),n.setLine(w.line,M)}}};
//# sourceMappingURL=main.js.map
