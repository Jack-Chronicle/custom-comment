"use strict";var q=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var Y=Object.prototype.hasOwnProperty;var Z=(O,x)=>{for(var n in x)q(O,n,{get:x[n],enumerable:!0})},ee=(O,x,n,o)=>{if(x&&typeof x=="object"||typeof x=="function")for(let c of X(x))!Y.call(O,c)&&c!==n&&q(O,c,{get:()=>x[c],enumerable:!(o=Q(x,c))||o.enumerable});return O};var te=O=>ee(q({},"__esModule",{value:!0}),O);var ie={};Z(ie,{default:()=>G});module.exports=te(ie);var H=require("obsidian");var z={template:"%% {cursor} %%",wordOnlyMode:!1,additionalMarkers:[]};var $=require("obsidian"),U=class extends $.PluginSettingTab{constructor(x,n){super(x,n),this.plugin=n}display(){let{containerEl:x}=this;x.empty(),new $.Setting(x).setName("Comment Format").setDesc("Use {cursor} wherever you want the cursor to go (e.g. '%% {cursor} %%' or '<!-- {cursor} -->').").addText(o=>o.setValue(this.plugin.settings.template).onChange(async c=>{this.plugin.settings.template=c||"%% {cursor} %%",await this.plugin.saveSettings()})),new $.Setting(x).setName("Word-only toggle mode").setDesc("If enabled, toggling will un/comment the word at the cursor's location rather than inserting a comment at the cursor position.").addToggle(o=>o.setValue(!!this.plugin.settings.wordOnlyMode).onChange(async c=>{this.plugin.settings.wordOnlyMode=c,await this.plugin.saveSettings()})),x.createEl("h3",{text:"Additional Marker Sets"}),(this.plugin.settings.additionalMarkers||[]).forEach((o,c)=>{let w=new $.Setting(x).setName(`Marker Set ${c+1}`).addToggle(u=>u.setValue(!!o.registerCommand).onChange(async l=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].registerCommand=l,await this.plugin.saveSettings(),this.plugin.registerMarkerCommands(!0),this.display())})).addText(u=>u.setPlaceholder("Start marker").setValue(o.start).onChange(async l=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].start=l,await this.plugin.saveSettings())})).addText(u=>u.setPlaceholder("End marker").setValue(o.end).onChange(async l=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers[c].end=l,await this.plugin.saveSettings())})).addExtraButton(u=>u.setIcon("cross").setTooltip("Remove marker set").onClick(async()=>{this.plugin.settings.additionalMarkers&&(this.plugin.settings.additionalMarkers.splice(c,1),await this.plugin.saveSettings(),this.display())}))}),new $.Setting(x).addButton(o=>o.setButtonText("Add Marker Set").setCta().onClick(async()=>{this.plugin.settings.additionalMarkers||(this.plugin.settings.additionalMarkers=[]),this.plugin.settings.additionalMarkers.push({start:"",end:"",registerCommand:!1}),await this.plugin.saveSettings(),this.display()}))}};function g(...O){console.log("[CustomComment DEV]",...O)}var ne=[{start:"%%",end:"%%"},{start:"<!--",end:"-->"},{start:"//",end:""}],G=class extends H.Plugin{constructor(){super(...arguments);this._markerCommandIds=[];this._cleanupGuard=!1}async onload(){g("Plugin loading..."),await this.loadSettings(),this.addSettingTab(new U(this.app,this)),this.addCommand({id:"reload-marker-commands",name:"Reload Marker Commands",callback:()=>this.registerMarkerCommands(!0)}),this.registerMarkerCommands()}registerMarkerCommands(n=!1){n&&this._markerCommandIds&&(this._markerCommandIds=[]),this._markerCommandIds=[];let o=this.settings.template??"%% {cursor} %%",c=o.indexOf("{cursor}"),w="%%",u="%%";c!==-1&&(w=o.slice(0,c).trim()||"%%",u=o.slice(c+8).trim()||"%%");let l="toggle-comment-template";this.addCommand({id:l,name:`Toggle Comment: (${w}|${u})`,editorCallback:a=>this.toggleComment(a)}),this._markerCommandIds.push(l),Array.isArray(this.settings.additionalMarkers)&&this.settings.additionalMarkers.forEach((a,I)=>{if(a&&a.registerCommand){let y=`toggle-comment-marker-set-${I+1}`;this.addCommand({id:y,name:(()=>{let h=a.start?.trim()||"%%",T=a.end?.trim()||"%%";return`Toggle Marker ${I+1}: (${h}|${T})`})(),checkCallback:(h,T)=>(!h&&T&&this.toggleComment(T,a),!0)}),this._markerCommandIds.push(y)}}),g("Marker commands registered:",this._markerCommandIds)}async loadSettings(){this.settings=Object.assign({},z,await this.loadData()),g("Settings loaded:",this.settings)}async saveSettings(){await this.saveData(this.settings),g("Settings saved:",this.settings)}async reloadPlugin(){await this.app.plugins.disablePlugin(this.manifest.id),await this.app.plugins.enablePlugin(this.manifest.id),g("Plugin reloaded")}insertComment(n){let o=this.settings.template,c=o.indexOf("{cursor}");if(c===-1){n.replaceSelection(o),g("Inserted template (no cursor placeholder)");return}let w=o.slice(0,c).trim(),u=o.slice(c+8).trim(),l=`${w} ${u}`.replace(/\s+/g," ").trim(),a=n.getCursor();n.replaceSelection(`${w}  ${u}`.replace(/\s+/g," ").replace(" "," {cursor} "));let I=w.split(`
`),y=I.length-1,h=I[I.length-1].length+1;n.setCursor({line:a.line+y,ch:(y?0:a.ch)+h}),g("Inserted comment at cursor")}toggleComment(n,o){g("toggleComment called",{selection:n.getSelection(),cursor:n.getCursor(),markerSet:o});let c,w;if(o)c=o.start.trim(),w=o.end.trim();else{let e=this.settings.template,t=e.indexOf("{cursor}"),r=e,s="";t!==-1&&(r=e.slice(0,t),s=e.slice(t+8)),c=r.trim(),w=s.trim()}function u(e){return e.replace(/\s+/g," ").trim()}let l=u(c),a=u(w);function I(e,t){let r=t.indexOf(e);if(r!==-1)return{idx:r,full:!0};for(let s=e.length-1;s>0;s--){if(t.includes(e.slice(0,s)))return{idx:t.indexOf(e.slice(0,s)),full:!1,partial:e.slice(0,s)};if(t.includes(e.slice(-s)))return{idx:t.indexOf(e.slice(-s)),full:!1,partial:e.slice(-s)}}return{idx:-1,full:!1}}function y({line:e,marker:t,partialIdx:r,isStart:s,otherMarker:b,uniqueMarkers:R=!0}){let V=t.length,P=-1;for(let k=Math.max(0,r-V+1);k<=r;k++)if(e.slice(k,k+V)===t){P=k;break}if(P===-1){for(let k=r;k<=Math.min(e.length-V,r+V-1);k++)if(e.slice(k,k+V)===t){P=k;break}}if(P===-1)return{confirmed:!1};if(s){let k=e.indexOf(b,P+V);if(k===-1)return{confirmed:!1};if(R){let W=e.indexOf(t,P+V);if(W!==-1&&W<k)return{confirmed:!1}}return{confirmed:!0,startIdx:P,endIdx:k}}else{let k=e.lastIndexOf(b,P-1);if(k===-1)return{confirmed:!1};if(R){let W=e.lastIndexOf(t,P-1);if(W!==-1&&W>k)return{confirmed:!1}}return{confirmed:!0,startIdx:k,endIdx:P}}}function h(e,t,r){return r==="back"?d.lastIndexOf(e,t):d.indexOf(e,t)}function T(e,t,r){let s=e.trim();return t&&r?s.startsWith(t)&&s.endsWith(r):t?s.startsWith(t):!1}function A(e){for(let t of ne){let r=u(t.start),s=u(t.end);if(T(e,r,s))return{found:!0,markerStart:t.start,markerEnd:t.end}}return{found:!1}}let M=n.getSelection(),i=n.getCursor(),E=n.getCursor("from"),v=n.getCursor("to"),d=n.getLine(i.line),_,p=null;function J(e,t){let r=/[\p{L}\p{N}_]+/gu,s;for(;(s=r.exec(e))!==null;)if(t>=s.index&&t<=s.index+s[0].length)return{start:s.index,end:s.index+s[0].length};return null}M?_=M:(p=J(d,i.ch),p&&i.ch>p.start&&i.ch<p.end?(_=d.slice(p.start,p.end),E={line:i.line,ch:p.start},v={line:i.line,ch:p.end}):(_="",E={line:i.line,ch:i.ch},v={line:i.line,ch:i.ch}));let f=-1,m=-1,D="",B=!1,C=l,S=a,N=!!(C&&S&&C!==S);g("[Detection] selection:",M),g("[Detection] text:",_);let L=I(l,_),F=I(a,_);if(g("[Detection] foundStart:",L),g("[Detection] foundEnd:",F),M)if(L.full&&F.full)g("[Detection] Both full markers found in selection."),f=h(l,v.ch,"back"),m=h(a,E.ch,"forward");else if(L.full){g("[Detection] Only full start marker found in selection.");let e=_.indexOf(l);e!==-1&&(f=E.ch+e,m=h(a,f+l.length,"forward"))}else if(F.full){g("[Detection] Only full end marker found in selection.");let e=_.indexOf(a);e!==-1&&(m=E.ch+e,f=h(l,m,"back"))}else if(L.idx!==-1&&!L.full){g("[Detection] Partial start marker found in selection.");let e=y({line:d,marker:l,partialIdx:E.ch+L.idx,isStart:!0,otherMarker:a,uniqueMarkers:N});if(g("[Detection] confirmPartialMarker result (start):",e),e.confirmed&&e.startIdx!==void 0&&e.endIdx!==void 0)f=e.startIdx,m=e.endIdx;else if(L.partial&&a.startsWith(L.partial)){g("[Detection] Partial start marker did not confirm, trying as partial end marker.");let t=y({line:d,marker:a,partialIdx:E.ch+L.idx,isStart:!1,otherMarker:l,uniqueMarkers:N});g("[Detection] confirmPartialMarker result (as end):",t),t.confirmed&&t.startIdx!==void 0&&t.endIdx!==void 0&&(f=t.startIdx,m=t.endIdx)}}else if(F.idx!==-1&&!F.full){g("[Detection] Partial end marker found in selection.");let e=y({line:d,marker:a,partialIdx:v.ch+F.idx,isStart:!1,otherMarker:l,uniqueMarkers:N});if(g("[Detection] confirmPartialMarker result (end):",e),e.confirmed&&e.startIdx!==void 0&&e.endIdx!==void 0)f=e.startIdx,m=e.endIdx;else if(F.partial&&l.startsWith(F.partial)){g("[Detection] Partial end marker did not confirm, trying as partial start marker.");let t=y({line:d,marker:l,partialIdx:v.ch+F.idx,isStart:!0,otherMarker:a,uniqueMarkers:N});g("[Detection] confirmPartialMarker result (as start):",t),t.confirmed&&t.startIdx!==void 0&&t.endIdx!==void 0&&(f=t.startIdx,m=t.endIdx)}}else g("[Detection] No marker found in selection, searching line."),f=h(l,v.ch,"back"),m=h(a,E.ch,"forward");else p?(f=h(l,p.start,"back"),m=h(a,p.end,"forward")):(f=h(l,i.ch,"back"),m=h(a,i.ch,"forward"));if(g("[Detection] startIdx:",f,"endIdx:",m),g("[Detection] region:",D),g("[Detection] regionIsComment:",B),f!==-1&&(!S||m!==-1&&f<m)){let e=f+l.length,t=S&&m!==-1?m:d.length;D=d.slice(e,t),T(d.slice(f,S&&m!==-1?m+a.length:d.length),l,a)&&(B=!0)}else{let e=A(d);if(e.found&&(C=e.markerStart?u(e.markerStart):"",S=e.markerEnd?u(e.markerEnd):"",f=h(C,i.ch,"back"),m=h(S,i.ch,"forward"),f!==-1&&(!S||m!==-1&&f<m))){let t=f+C.length,r=S&&m!==-1?m:d.length;D=d.slice(t,r),T(d.slice(f,S&&m!==-1?m+S.length:d.length),C,S)&&(B=!0)}}if(B){let e=d.slice(0,f),t=d.slice(S&&m!==-1?m+S.length:d.length);D.startsWith(" ")&&(D=D.slice(1)),D.endsWith(" ")&&(D=D.slice(0,-1));let r=e+D+t;n.setLine(i.line,r);let s=0;if(M){let b=e.length,R={line:i.line,ch:b},V={line:i.line,ch:b+D.length};n.setSelection(R,V)}else if(p){let b=e.length;n.setCursor({line:i.line,ch:b})}else{s=(i.ch>f?Math.min(i.ch,f+C.length)-f:0)+C.length;let b=i.ch-s;b<e.length&&(b=e.length),n.setCursor({line:i.line,ch:b})}g("Uncommented region",{from:E,to:v,region:D})}else{let e=_;!M&&!p&&!_.trim()&&(e="");let t,r;if(M){t=C+(e?" ":"")+e+(e?" ":"")+S,r=d.slice(0,E.ch)+t+d.slice(v.ch),n.setLine(i.line,r);let s={line:i.line,ch:E.ch+C.length+(e?1:0)},b={line:i.line,ch:E.ch+C.length+(e?1:0)+e.length};n.setSelection(s,b)}else if(p&&this.settings.wordOnlyMode){t=C+" "+d.slice(p.start,p.end)+" "+S,r=d.slice(0,p.start)+t+d.slice(p.end),n.setLine(i.line,r);let s={line:i.line,ch:p.start+C.length+1},b={line:i.line,ch:p.start+C.length+1+(p.end-p.start)};n.setSelection(s,b)}else p?(t=C+"  "+S,r=d.slice(0,i.ch)+t+d.slice(i.ch),n.setLine(i.line,r),n.setCursor({line:i.line,ch:i.ch+C.length+1})):(t=C+"  "+S,r=d.slice(0,i.ch)+t+d.slice(i.ch),n.setLine(i.line,r),n.setCursor({line:i.line,ch:i.ch+C.length+1}));g("Commented region",{from:E,to:v,commented:t})}function K(e){let t=n.getValue().split(`
`),r=Math.max(0,Math.min(e.line,t.length-1)),s=Math.max(0,Math.min(e.ch,t[r]?.length??0));return{line:r,ch:s}}let j=K(n.getCursor());(j.line!==n.getCursor().line||j.ch!==n.getCursor().ch)&&n.setCursor(j)}toggleCommentAtCursor(n){let o=this.settings.template,c=o.indexOf("{cursor}"),w=o,u="";c!==-1&&(w=o.slice(0,c),u=o.slice(c+8));let l=w.trim(),a=u.trim(),I=n.getCursor(),y=n.getLine(I.line),h=y.indexOf(l),T=a?y.lastIndexOf(a):-1,A=!1;if(l&&a?A=h!==-1&&T!==-1&&I.ch>=h+l.length&&I.ch<=T:l&&(A=h!==-1&&I.ch>=h+l.length),A){let M=y;l&&(M=M.replace(l,"")),a&&(M=M.replace(a,"")),M=M.trim(),n.setLine(I.line,M)}}};
//# sourceMappingURL=main.js.map
